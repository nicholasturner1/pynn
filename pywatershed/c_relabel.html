<!DOCTYPE html>
<!-- Generated by Cython 0.22 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code  { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 20px;  }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
    </style>
    <script>
    function toggleDiv(id) {
        theDiv = id.nextElementSibling
        if (theDiv.style.display != 'block') theDiv.style.display = 'block';
        else theDiv.style.display = 'none';
    }
    </script>
</head>
<body class="cython">
<p>Generated by Cython 0.22</p>
<p>Raw output: <a href="c_relabel.c">c_relabel.c</a></p>
<div class="cython"><pre class='cython line score-11' onclick='toggleDiv(this)'>+01: # -*- coding: utf-8 -*-</pre>
<pre class='cython code score-11'>  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='cython line score-0'>&#xA0;02: """</pre>
<pre class='cython line score-0'>&#xA0;03: Created on Wed Apr 15 16:40:02 2015</pre>
<pre class='cython line score-0'>&#xA0;04: </pre>
<pre class='cython line score-0'>&#xA0;05: @author: jingpeng</pre>
<pre class='cython line score-0'>&#xA0;06: """</pre>
<pre class='cython line score-0'>&#xA0;07: #defining NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION</pre>
<pre class='cython line score-8' onclick='toggleDiv(this)'>+08: import numpy as np</pre>
<pre class='cython code score-8'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 8; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 8; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='cython line score-0'>&#xA0;09: cimport numpy as np</pre>
<pre class='cython line score-0'>&#xA0;10: cimport cython</pre>
<pre class='cython line score-0'>&#xA0;11: #@cython.boundscheck(False) # turn of bounds-checking for entire function</pre>
<pre class='cython line score-0'>&#xA0;12: #@cython.wraparound(False)</pre>
<pre class='cython line score-0'>&#xA0;13: #@cython.nonecheck(False)</pre>
<pre class='cython line score-0'>&#xA0;14: </pre>
<pre class='cython line score-0'>&#xA0;15: #%% depth first search</pre>
<pre class='cython line score-139' onclick='toggleDiv(this)'>+16: def dfs(np.ndarray[np.uint32_t, ndim=3] seg,\</pre>
<pre class='cython code score-139'>/* Python wrapper */
static PyObject *__pyx_pw_11pywatershed_9c_relabel_1dfs(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_11pywatershed_9c_relabel_1dfs = {"dfs", (PyCFunction)__pyx_pw_11pywatershed_9c_relabel_1dfs, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_11pywatershed_9c_relabel_1dfs(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_seg = 0;
  PyArrayObject *__pyx_v_seg2 = 0;
  PyArrayObject *__pyx_v_mask = 0;
  __pyx_t_5numpy_uint32_t __pyx_v_relid;
  __pyx_t_5numpy_uint32_t __pyx_v_label;
  int __pyx_v_z;
  int __pyx_v_y;
  int __pyx_v_x;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("dfs (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_seg,&amp;__pyx_n_s_seg2,&amp;__pyx_n_s_mask,&amp;__pyx_n_s_relid,&amp;__pyx_n_s_label,&amp;__pyx_n_s_z,&amp;__pyx_n_s_y,&amp;__pyx_n_s_x,0};
    PyObject* values[8] = {0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_seg)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_seg2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dfs", 1, 8, 8, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_mask)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dfs", 1, 8, 8, 2); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_relid)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dfs", 1, 8, 8, 3); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  4:
        if (likely((values[4] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_label)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dfs", 1, 8, 8, 4); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  5:
        if (likely((values[5] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dfs", 1, 8, 8, 5); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  6:
        if (likely((values[6] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_y)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dfs", 1, 8, 8, 6); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  7:
        if (likely((values[7] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_x)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dfs", 1, 8, 8, 7); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "dfs") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 8) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
      values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
      values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
    }
    __pyx_v_seg = ((PyArrayObject *)values[0]);
    __pyx_v_seg2 = ((PyArrayObject *)values[1]);
    __pyx_v_mask = ((PyArrayObject *)values[2]);
    __pyx_v_relid = __Pyx_PyInt_As_npy_uint32(values[3]);<span class='error_goto'> if (unlikely((__pyx_v_relid == (npy_uint32)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_label = __Pyx_PyInt_As_npy_uint32(values[4]);<span class='error_goto'> if (unlikely((__pyx_v_label == (npy_uint32)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_z = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[5]);<span class='error_goto'> if (unlikely((__pyx_v_z == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_y = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[6]);<span class='error_goto'> if (unlikely((__pyx_v_y == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_x = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[7]);<span class='error_goto'> if (unlikely((__pyx_v_x == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dfs", 1, 8, 8, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pywatershed.c_relabel.dfs", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_seg), __pyx_ptype_5numpy_ndarray, 1, "seg", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_seg2), __pyx_ptype_5numpy_ndarray, 1, "seg2", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 17; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_mask), __pyx_ptype_5numpy_ndarray, 1, "mask", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_11pywatershed_9c_relabel_dfs(__pyx_self, __pyx_v_seg, __pyx_v_seg2, __pyx_v_mask, __pyx_v_relid, __pyx_v_label, __pyx_v_z, __pyx_v_y, __pyx_v_x);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11pywatershed_9c_relabel_dfs(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_seg, PyArrayObject *__pyx_v_seg2, PyArrayObject *__pyx_v_mask, __pyx_t_5numpy_uint32_t __pyx_v_relid, __pyx_t_5numpy_uint32_t __pyx_v_label, int __pyx_v_z, int __pyx_v_y, int __pyx_v_x) {
  PyObject *__pyx_v_seeds = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_mask;
  __Pyx_Buffer __pyx_pybuffer_mask;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_seg;
  __Pyx_Buffer __pyx_pybuffer_seg;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_seg2;
  __Pyx_Buffer __pyx_pybuffer_seg2;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("dfs", 0);
  __pyx_pybuffer_seg.pybuffer.buf = NULL;
  __pyx_pybuffer_seg.refcount = 0;
  __pyx_pybuffernd_seg.data = NULL;
  __pyx_pybuffernd_seg.rcbuffer = &amp;__pyx_pybuffer_seg;
  __pyx_pybuffer_seg2.pybuffer.buf = NULL;
  __pyx_pybuffer_seg2.refcount = 0;
  __pyx_pybuffernd_seg2.data = NULL;
  __pyx_pybuffernd_seg2.rcbuffer = &amp;__pyx_pybuffer_seg2;
  __pyx_pybuffer_mask.pybuffer.buf = NULL;
  __pyx_pybuffer_mask.refcount = 0;
  __pyx_pybuffernd_mask.data = NULL;
  __pyx_pybuffernd_mask.rcbuffer = &amp;__pyx_pybuffer_mask;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_seg, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_seg.diminfo[0].strides = __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_seg.diminfo[0].shape = __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_seg.diminfo[1].strides = __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_seg.diminfo[1].shape = __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_seg.diminfo[2].strides = __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_seg.diminfo[2].shape = __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.shape[2];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_seg2, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_seg2.diminfo[0].strides = __pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_seg2.diminfo[0].shape = __pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_seg2.diminfo[1].strides = __pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_seg2.diminfo[1].shape = __pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_seg2.diminfo[2].strides = __pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_seg2.diminfo[2].shape = __pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer.shape[2];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_mask, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_mask.diminfo[0].strides = __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_mask.diminfo[0].shape = __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_mask.diminfo[1].strides = __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_mask.diminfo[1].shape = __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_mask.diminfo[2].strides = __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_mask.diminfo[2].shape = __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.shape[2];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pywatershed.c_relabel.dfs", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_seeds);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__7 = <span class='py_c_api'>PyTuple_Pack</span>(9, __pyx_n_s_seg, __pyx_n_s_seg2, __pyx_n_s_mask, __pyx_n_s_relid, __pyx_n_s_label, __pyx_n_s_z, __pyx_n_s_y, __pyx_n_s_x, __pyx_n_s_seeds);<span class='error_goto'> if (unlikely(!__pyx_tuple__7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__7);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_11pywatershed_9c_relabel_1dfs, NULL, __pyx_n_s_pywatershed_c_relabel);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_dfs, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__8 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(8, 0, 9, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__7, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_usr_people_nturner_bin_pywaters, __pyx_n_s_dfs, 16, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='cython line score-0'>&#xA0;17:         np.ndarray[np.uint32_t, ndim=3] seg2,\</pre>
<pre class='cython line score-0'>&#xA0;18:         np.ndarray[np.uint8_t,  ndim=3, cast=True] mask, \</pre>
<pre class='cython line score-0'>&#xA0;19:         np.uint32_t relid, \</pre>
<pre class='cython line score-0'>&#xA0;20:         np.uint32_t label, \</pre>
<pre class='cython line score-0'>&#xA0;21:         int z, int y, int x):</pre>
<pre class='cython line score-5' onclick='toggleDiv(this)'>+22:     cdef list seeds = []</pre>
<pre class='cython code score-5'>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_seeds = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='cython line score-17' onclick='toggleDiv(this)'>+23:     seeds.append((z,y,x))</pre>
<pre class='cython code score-17'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_z);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_y);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_x);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 2, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyList_Append</span>(__pyx_v_seeds, __pyx_t_4);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class='cython line score-1' onclick='toggleDiv(this)'>+24:     while seeds:</pre>
<pre class='cython code score-1'>  while (1) {
    __pyx_t_6 = (__pyx_v_seeds != Py_None) &amp;&amp; (<span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_v_seeds) != 0);
    if (!__pyx_t_6) break;
</pre><pre class='cython line score-62' onclick='toggleDiv(this)'>+25:         z,y,x = seeds.pop()</pre>
<pre class='cython code score-62'>    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyList_Pop</span>(__pyx_v_seeds);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    if ((likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_4))) || (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_4))) {
      PyObject* sequence = __pyx_t_4;
      #if CYTHON_COMPILING_IN_CPYTHON
      Py_ssize_t size = Py_SIZE(sequence);
      #else
      Py_ssize_t size = <span class='py_c_api'>PySequence_Size</span>(sequence);
      #endif
      if (unlikely(size != 3)) {
        if (size &gt; 3) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(3);
        else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      #if CYTHON_COMPILING_IN_CPYTHON
      if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(sequence))) {
        __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
        __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
        __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 2); 
      } else {
        __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
        __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
        __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 2); 
      }
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
      #else
      __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      #endif
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_7 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_8 = Py_TYPE(__pyx_t_7)-&gt;tp_iternext;
      index = 0; __pyx_t_3 = __pyx_t_8(__pyx_t_7); if (unlikely(!__pyx_t_3)) goto __pyx_L5_unpacking_failed;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      index = 1; __pyx_t_2 = __pyx_t_8(__pyx_t_7); if (unlikely(!__pyx_t_2)) goto __pyx_L5_unpacking_failed;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      index = 2; __pyx_t_1 = __pyx_t_8(__pyx_t_7); if (unlikely(!__pyx_t_1)) goto __pyx_L5_unpacking_failed;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_8(__pyx_t_7), 3) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_8 = NULL;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      goto __pyx_L6_unpacking_done;
      __pyx_L5_unpacking_failed:;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_8 = NULL;
      if (<span class='pyx_c_api'>__Pyx_IterFinish</span>() == 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_L6_unpacking_done:;
    }
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3);<span class='error_goto'> if (unlikely((__pyx_t_9 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_10 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_11 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_z = __pyx_t_9;
    __pyx_v_y = __pyx_t_10;
    __pyx_v_x = __pyx_t_11;
</pre><pre class='cython line score-2' onclick='toggleDiv(this)'>+26:         seg2[z,y,x] = relid</pre>
<pre class='cython code score-2'>    __pyx_t_11 = __pyx_v_z;
    __pyx_t_10 = __pyx_v_y;
    __pyx_t_9 = __pyx_v_x;
    __pyx_t_12 = -1;
    if (__pyx_t_11 &lt; 0) {
      __pyx_t_11 += __pyx_pybuffernd_seg2.diminfo[0].shape;
      if (unlikely(__pyx_t_11 &lt; 0)) __pyx_t_12 = 0;
    } else if (unlikely(__pyx_t_11 &gt;= __pyx_pybuffernd_seg2.diminfo[0].shape)) __pyx_t_12 = 0;
    if (__pyx_t_10 &lt; 0) {
      __pyx_t_10 += __pyx_pybuffernd_seg2.diminfo[1].shape;
      if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_12 = 1;
    } else if (unlikely(__pyx_t_10 &gt;= __pyx_pybuffernd_seg2.diminfo[1].shape)) __pyx_t_12 = 1;
    if (__pyx_t_9 &lt; 0) {
      __pyx_t_9 += __pyx_pybuffernd_seg2.diminfo[2].shape;
      if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_12 = 2;
    } else if (unlikely(__pyx_t_9 &gt;= __pyx_pybuffernd_seg2.diminfo[2].shape)) __pyx_t_12 = 2;
    if (unlikely(__pyx_t_12 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_12);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    *__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_seg2.diminfo[0].strides, __pyx_t_10, __pyx_pybuffernd_seg2.diminfo[1].strides, __pyx_t_9, __pyx_pybuffernd_seg2.diminfo[2].strides) = __pyx_v_relid;
</pre><pre class='cython line score-2' onclick='toggleDiv(this)'>+27:         mask[z,y,x] = True</pre>
<pre class='cython code score-2'>    __pyx_t_12 = __pyx_v_z;
    __pyx_t_13 = __pyx_v_y;
    __pyx_t_14 = __pyx_v_x;
    __pyx_t_15 = -1;
    if (__pyx_t_12 &lt; 0) {
      __pyx_t_12 += __pyx_pybuffernd_mask.diminfo[0].shape;
      if (unlikely(__pyx_t_12 &lt; 0)) __pyx_t_15 = 0;
    } else if (unlikely(__pyx_t_12 &gt;= __pyx_pybuffernd_mask.diminfo[0].shape)) __pyx_t_15 = 0;
    if (__pyx_t_13 &lt; 0) {
      __pyx_t_13 += __pyx_pybuffernd_mask.diminfo[1].shape;
      if (unlikely(__pyx_t_13 &lt; 0)) __pyx_t_15 = 1;
    } else if (unlikely(__pyx_t_13 &gt;= __pyx_pybuffernd_mask.diminfo[1].shape)) __pyx_t_15 = 1;
    if (__pyx_t_14 &lt; 0) {
      __pyx_t_14 += __pyx_pybuffernd_mask.diminfo[2].shape;
      if (unlikely(__pyx_t_14 &lt; 0)) __pyx_t_15 = 2;
    } else if (unlikely(__pyx_t_14 &gt;= __pyx_pybuffernd_mask.diminfo[2].shape)) __pyx_t_15 = 2;
    if (unlikely(__pyx_t_15 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_15);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    *__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint8_t *, __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_mask.diminfo[0].strides, __pyx_t_13, __pyx_pybuffernd_mask.diminfo[1].strides, __pyx_t_14, __pyx_pybuffernd_mask.diminfo[2].strides) = 1;
</pre><pre class='cython line score-0'>&#xA0;28: </pre>
<pre class='cython line score-4' onclick='toggleDiv(this)'>+29:         if z+1&lt;seg.shape[0] and seg[z+1,y,x] == label and not mask[z+1,y,x] :</pre>
<pre class='cython code score-4'>    __pyx_t_16 = (((__pyx_v_z + 1) &lt; (__pyx_v_seg-&gt;dimensions[0])) != 0);
    if (__pyx_t_16) {
    } else {
      __pyx_t_6 = __pyx_t_16;
      goto __pyx_L8_bool_binop_done;
    }
    __pyx_t_17 = (__pyx_v_z + 1);
    __pyx_t_15 = __pyx_v_y;
    __pyx_t_18 = __pyx_v_x;
    __pyx_t_19 = -1;
    if (__pyx_t_17 &lt; 0) {
      __pyx_t_17 += __pyx_pybuffernd_seg.diminfo[0].shape;
      if (unlikely(__pyx_t_17 &lt; 0)) __pyx_t_19 = 0;
    } else if (unlikely(__pyx_t_17 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_19 = 0;
    if (__pyx_t_15 &lt; 0) {
      __pyx_t_15 += __pyx_pybuffernd_seg.diminfo[1].shape;
      if (unlikely(__pyx_t_15 &lt; 0)) __pyx_t_19 = 1;
    } else if (unlikely(__pyx_t_15 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_19 = 1;
    if (__pyx_t_18 &lt; 0) {
      __pyx_t_18 += __pyx_pybuffernd_seg.diminfo[2].shape;
      if (unlikely(__pyx_t_18 &lt; 0)) __pyx_t_19 = 2;
    } else if (unlikely(__pyx_t_18 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_19 = 2;
    if (unlikely(__pyx_t_19 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_19);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_16 = (((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_seg.diminfo[2].strides)) == __pyx_v_label) != 0);
    if (__pyx_t_16) {
    } else {
      __pyx_t_6 = __pyx_t_16;
      goto __pyx_L8_bool_binop_done;
    }
    __pyx_t_20 = (__pyx_v_z + 1);
    __pyx_t_19 = __pyx_v_y;
    __pyx_t_21 = __pyx_v_x;
    __pyx_t_22 = -1;
    if (__pyx_t_20 &lt; 0) {
      __pyx_t_20 += __pyx_pybuffernd_mask.diminfo[0].shape;
      if (unlikely(__pyx_t_20 &lt; 0)) __pyx_t_22 = 0;
    } else if (unlikely(__pyx_t_20 &gt;= __pyx_pybuffernd_mask.diminfo[0].shape)) __pyx_t_22 = 0;
    if (__pyx_t_19 &lt; 0) {
      __pyx_t_19 += __pyx_pybuffernd_mask.diminfo[1].shape;
      if (unlikely(__pyx_t_19 &lt; 0)) __pyx_t_22 = 1;
    } else if (unlikely(__pyx_t_19 &gt;= __pyx_pybuffernd_mask.diminfo[1].shape)) __pyx_t_22 = 1;
    if (__pyx_t_21 &lt; 0) {
      __pyx_t_21 += __pyx_pybuffernd_mask.diminfo[2].shape;
      if (unlikely(__pyx_t_21 &lt; 0)) __pyx_t_22 = 2;
    } else if (unlikely(__pyx_t_21 &gt;= __pyx_pybuffernd_mask.diminfo[2].shape)) __pyx_t_22 = 2;
    if (unlikely(__pyx_t_22 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_22);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_16 = ((!((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint8_t *, __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_mask.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_mask.diminfo[1].strides, __pyx_t_21, __pyx_pybuffernd_mask.diminfo[2].strides)) != 0)) != 0);
    __pyx_t_6 = __pyx_t_16;
    __pyx_L8_bool_binop_done:;
    if (__pyx_t_6) {
</pre><pre class='cython line score-17' onclick='toggleDiv(this)'>+30:             seeds.append((z+1,y,x))</pre>
<pre class='cython code score-17'>      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((__pyx_v_z + 1));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_y);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_x);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_4);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 2, __pyx_t_2);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
      __pyx_t_4 = 0;
      __pyx_t_1 = 0;
      __pyx_t_2 = 0;
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyList_Append</span>(__pyx_v_seeds, __pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L7;
    }
    __pyx_L7:;
</pre><pre class='cython line score-4' onclick='toggleDiv(this)'>+31:         if z-1&gt;=0    and seg[z-1,y,x] == label and not mask[z-1,y,x] :</pre>
<pre class='cython code score-4'>    __pyx_t_16 = (((__pyx_v_z - 1) &gt;= 0) != 0);
    if (__pyx_t_16) {
    } else {
      __pyx_t_6 = __pyx_t_16;
      goto __pyx_L12_bool_binop_done;
    }
    __pyx_t_23 = (__pyx_v_z - 1);
    __pyx_t_22 = __pyx_v_y;
    __pyx_t_24 = __pyx_v_x;
    __pyx_t_25 = -1;
    if (__pyx_t_23 &lt; 0) {
      __pyx_t_23 += __pyx_pybuffernd_seg.diminfo[0].shape;
      if (unlikely(__pyx_t_23 &lt; 0)) __pyx_t_25 = 0;
    } else if (unlikely(__pyx_t_23 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_25 = 0;
    if (__pyx_t_22 &lt; 0) {
      __pyx_t_22 += __pyx_pybuffernd_seg.diminfo[1].shape;
      if (unlikely(__pyx_t_22 &lt; 0)) __pyx_t_25 = 1;
    } else if (unlikely(__pyx_t_22 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_25 = 1;
    if (__pyx_t_24 &lt; 0) {
      __pyx_t_24 += __pyx_pybuffernd_seg.diminfo[2].shape;
      if (unlikely(__pyx_t_24 &lt; 0)) __pyx_t_25 = 2;
    } else if (unlikely(__pyx_t_24 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_25 = 2;
    if (unlikely(__pyx_t_25 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_25);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_16 = (((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_23, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_22, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_24, __pyx_pybuffernd_seg.diminfo[2].strides)) == __pyx_v_label) != 0);
    if (__pyx_t_16) {
    } else {
      __pyx_t_6 = __pyx_t_16;
      goto __pyx_L12_bool_binop_done;
    }
    __pyx_t_26 = (__pyx_v_z - 1);
    __pyx_t_25 = __pyx_v_y;
    __pyx_t_27 = __pyx_v_x;
    __pyx_t_28 = -1;
    if (__pyx_t_26 &lt; 0) {
      __pyx_t_26 += __pyx_pybuffernd_mask.diminfo[0].shape;
      if (unlikely(__pyx_t_26 &lt; 0)) __pyx_t_28 = 0;
    } else if (unlikely(__pyx_t_26 &gt;= __pyx_pybuffernd_mask.diminfo[0].shape)) __pyx_t_28 = 0;
    if (__pyx_t_25 &lt; 0) {
      __pyx_t_25 += __pyx_pybuffernd_mask.diminfo[1].shape;
      if (unlikely(__pyx_t_25 &lt; 0)) __pyx_t_28 = 1;
    } else if (unlikely(__pyx_t_25 &gt;= __pyx_pybuffernd_mask.diminfo[1].shape)) __pyx_t_28 = 1;
    if (__pyx_t_27 &lt; 0) {
      __pyx_t_27 += __pyx_pybuffernd_mask.diminfo[2].shape;
      if (unlikely(__pyx_t_27 &lt; 0)) __pyx_t_28 = 2;
    } else if (unlikely(__pyx_t_27 &gt;= __pyx_pybuffernd_mask.diminfo[2].shape)) __pyx_t_28 = 2;
    if (unlikely(__pyx_t_28 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_28);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_16 = ((!((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint8_t *, __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.buf, __pyx_t_26, __pyx_pybuffernd_mask.diminfo[0].strides, __pyx_t_25, __pyx_pybuffernd_mask.diminfo[1].strides, __pyx_t_27, __pyx_pybuffernd_mask.diminfo[2].strides)) != 0)) != 0);
    __pyx_t_6 = __pyx_t_16;
    __pyx_L12_bool_binop_done:;
    if (__pyx_t_6) {
</pre><pre class='cython line score-17' onclick='toggleDiv(this)'>+32:             seeds.append((z-1,y,x))</pre>
<pre class='cython code score-17'>      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((__pyx_v_z - 1));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_y);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_x);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_3);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_2);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 2, __pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      __pyx_t_3 = 0;
      __pyx_t_2 = 0;
      __pyx_t_1 = 0;
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyList_Append</span>(__pyx_v_seeds, __pyx_t_4);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      goto __pyx_L11;
    }
    __pyx_L11:;
</pre><pre class='cython line score-4' onclick='toggleDiv(this)'>+33:         if y+1&lt;seg.shape[1] and seg[z,y+1,x] == label and not mask[z,y+1,x] :</pre>
<pre class='cython code score-4'>    __pyx_t_16 = (((__pyx_v_y + 1) &lt; (__pyx_v_seg-&gt;dimensions[1])) != 0);
    if (__pyx_t_16) {
    } else {
      __pyx_t_6 = __pyx_t_16;
      goto __pyx_L16_bool_binop_done;
    }
    __pyx_t_28 = __pyx_v_z;
    __pyx_t_29 = (__pyx_v_y + 1);
    __pyx_t_30 = __pyx_v_x;
    __pyx_t_31 = -1;
    if (__pyx_t_28 &lt; 0) {
      __pyx_t_28 += __pyx_pybuffernd_seg.diminfo[0].shape;
      if (unlikely(__pyx_t_28 &lt; 0)) __pyx_t_31 = 0;
    } else if (unlikely(__pyx_t_28 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_31 = 0;
    if (__pyx_t_29 &lt; 0) {
      __pyx_t_29 += __pyx_pybuffernd_seg.diminfo[1].shape;
      if (unlikely(__pyx_t_29 &lt; 0)) __pyx_t_31 = 1;
    } else if (unlikely(__pyx_t_29 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_31 = 1;
    if (__pyx_t_30 &lt; 0) {
      __pyx_t_30 += __pyx_pybuffernd_seg.diminfo[2].shape;
      if (unlikely(__pyx_t_30 &lt; 0)) __pyx_t_31 = 2;
    } else if (unlikely(__pyx_t_30 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_31 = 2;
    if (unlikely(__pyx_t_31 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_31);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_16 = (((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_28, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_29, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_30, __pyx_pybuffernd_seg.diminfo[2].strides)) == __pyx_v_label) != 0);
    if (__pyx_t_16) {
    } else {
      __pyx_t_6 = __pyx_t_16;
      goto __pyx_L16_bool_binop_done;
    }
    __pyx_t_31 = __pyx_v_z;
    __pyx_t_32 = (__pyx_v_y + 1);
    __pyx_t_33 = __pyx_v_x;
    __pyx_t_34 = -1;
    if (__pyx_t_31 &lt; 0) {
      __pyx_t_31 += __pyx_pybuffernd_mask.diminfo[0].shape;
      if (unlikely(__pyx_t_31 &lt; 0)) __pyx_t_34 = 0;
    } else if (unlikely(__pyx_t_31 &gt;= __pyx_pybuffernd_mask.diminfo[0].shape)) __pyx_t_34 = 0;
    if (__pyx_t_32 &lt; 0) {
      __pyx_t_32 += __pyx_pybuffernd_mask.diminfo[1].shape;
      if (unlikely(__pyx_t_32 &lt; 0)) __pyx_t_34 = 1;
    } else if (unlikely(__pyx_t_32 &gt;= __pyx_pybuffernd_mask.diminfo[1].shape)) __pyx_t_34 = 1;
    if (__pyx_t_33 &lt; 0) {
      __pyx_t_33 += __pyx_pybuffernd_mask.diminfo[2].shape;
      if (unlikely(__pyx_t_33 &lt; 0)) __pyx_t_34 = 2;
    } else if (unlikely(__pyx_t_33 &gt;= __pyx_pybuffernd_mask.diminfo[2].shape)) __pyx_t_34 = 2;
    if (unlikely(__pyx_t_34 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_34);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_16 = ((!((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint8_t *, __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.buf, __pyx_t_31, __pyx_pybuffernd_mask.diminfo[0].strides, __pyx_t_32, __pyx_pybuffernd_mask.diminfo[1].strides, __pyx_t_33, __pyx_pybuffernd_mask.diminfo[2].strides)) != 0)) != 0);
    __pyx_t_6 = __pyx_t_16;
    __pyx_L16_bool_binop_done:;
    if (__pyx_t_6) {
</pre><pre class='cython line score-17' onclick='toggleDiv(this)'>+34:             seeds.append((z,y+1,x))</pre>
<pre class='cython code score-17'>      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_z);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((__pyx_v_y + 1));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_x);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_4);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 2, __pyx_t_2);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
      __pyx_t_4 = 0;
      __pyx_t_1 = 0;
      __pyx_t_2 = 0;
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyList_Append</span>(__pyx_v_seeds, __pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L15;
    }
    __pyx_L15:;
</pre><pre class='cython line score-4' onclick='toggleDiv(this)'>+35:         if y-1&gt;=0    and seg[z,y-1,x] == label and not mask[z,y-1,x] :</pre>
<pre class='cython code score-4'>    __pyx_t_16 = (((__pyx_v_y - 1) &gt;= 0) != 0);
    if (__pyx_t_16) {
    } else {
      __pyx_t_6 = __pyx_t_16;
      goto __pyx_L20_bool_binop_done;
    }
    __pyx_t_34 = __pyx_v_z;
    __pyx_t_35 = (__pyx_v_y - 1);
    __pyx_t_36 = __pyx_v_x;
    __pyx_t_37 = -1;
    if (__pyx_t_34 &lt; 0) {
      __pyx_t_34 += __pyx_pybuffernd_seg.diminfo[0].shape;
      if (unlikely(__pyx_t_34 &lt; 0)) __pyx_t_37 = 0;
    } else if (unlikely(__pyx_t_34 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_37 = 0;
    if (__pyx_t_35 &lt; 0) {
      __pyx_t_35 += __pyx_pybuffernd_seg.diminfo[1].shape;
      if (unlikely(__pyx_t_35 &lt; 0)) __pyx_t_37 = 1;
    } else if (unlikely(__pyx_t_35 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_37 = 1;
    if (__pyx_t_36 &lt; 0) {
      __pyx_t_36 += __pyx_pybuffernd_seg.diminfo[2].shape;
      if (unlikely(__pyx_t_36 &lt; 0)) __pyx_t_37 = 2;
    } else if (unlikely(__pyx_t_36 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_37 = 2;
    if (unlikely(__pyx_t_37 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_37);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_16 = (((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_34, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_35, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_36, __pyx_pybuffernd_seg.diminfo[2].strides)) == __pyx_v_label) != 0);
    if (__pyx_t_16) {
    } else {
      __pyx_t_6 = __pyx_t_16;
      goto __pyx_L20_bool_binop_done;
    }
    __pyx_t_37 = __pyx_v_z;
    __pyx_t_38 = (__pyx_v_y - 1);
    __pyx_t_39 = __pyx_v_x;
    __pyx_t_40 = -1;
    if (__pyx_t_37 &lt; 0) {
      __pyx_t_37 += __pyx_pybuffernd_mask.diminfo[0].shape;
      if (unlikely(__pyx_t_37 &lt; 0)) __pyx_t_40 = 0;
    } else if (unlikely(__pyx_t_37 &gt;= __pyx_pybuffernd_mask.diminfo[0].shape)) __pyx_t_40 = 0;
    if (__pyx_t_38 &lt; 0) {
      __pyx_t_38 += __pyx_pybuffernd_mask.diminfo[1].shape;
      if (unlikely(__pyx_t_38 &lt; 0)) __pyx_t_40 = 1;
    } else if (unlikely(__pyx_t_38 &gt;= __pyx_pybuffernd_mask.diminfo[1].shape)) __pyx_t_40 = 1;
    if (__pyx_t_39 &lt; 0) {
      __pyx_t_39 += __pyx_pybuffernd_mask.diminfo[2].shape;
      if (unlikely(__pyx_t_39 &lt; 0)) __pyx_t_40 = 2;
    } else if (unlikely(__pyx_t_39 &gt;= __pyx_pybuffernd_mask.diminfo[2].shape)) __pyx_t_40 = 2;
    if (unlikely(__pyx_t_40 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_40);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_16 = ((!((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint8_t *, __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.buf, __pyx_t_37, __pyx_pybuffernd_mask.diminfo[0].strides, __pyx_t_38, __pyx_pybuffernd_mask.diminfo[1].strides, __pyx_t_39, __pyx_pybuffernd_mask.diminfo[2].strides)) != 0)) != 0);
    __pyx_t_6 = __pyx_t_16;
    __pyx_L20_bool_binop_done:;
    if (__pyx_t_6) {
</pre><pre class='cython line score-17' onclick='toggleDiv(this)'>+36:             seeds.append((z,y-1,x))</pre>
<pre class='cython code score-17'>      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_z);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((__pyx_v_y - 1));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_x);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_3);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_2);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 2, __pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      __pyx_t_3 = 0;
      __pyx_t_2 = 0;
      __pyx_t_1 = 0;
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyList_Append</span>(__pyx_v_seeds, __pyx_t_4);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      goto __pyx_L19;
    }
    __pyx_L19:;
</pre><pre class='cython line score-4' onclick='toggleDiv(this)'>+37:         if x+1&lt;seg.shape[2] and seg[z,y,x+1] == label and not mask[z,y,x+1] :</pre>
<pre class='cython code score-4'>    __pyx_t_16 = (((__pyx_v_x + 1) &lt; (__pyx_v_seg-&gt;dimensions[2])) != 0);
    if (__pyx_t_16) {
    } else {
      __pyx_t_6 = __pyx_t_16;
      goto __pyx_L24_bool_binop_done;
    }
    __pyx_t_40 = __pyx_v_z;
    __pyx_t_41 = __pyx_v_y;
    __pyx_t_42 = (__pyx_v_x + 1);
    __pyx_t_43 = -1;
    if (__pyx_t_40 &lt; 0) {
      __pyx_t_40 += __pyx_pybuffernd_seg.diminfo[0].shape;
      if (unlikely(__pyx_t_40 &lt; 0)) __pyx_t_43 = 0;
    } else if (unlikely(__pyx_t_40 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_43 = 0;
    if (__pyx_t_41 &lt; 0) {
      __pyx_t_41 += __pyx_pybuffernd_seg.diminfo[1].shape;
      if (unlikely(__pyx_t_41 &lt; 0)) __pyx_t_43 = 1;
    } else if (unlikely(__pyx_t_41 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_43 = 1;
    if (__pyx_t_42 &lt; 0) {
      __pyx_t_42 += __pyx_pybuffernd_seg.diminfo[2].shape;
      if (unlikely(__pyx_t_42 &lt; 0)) __pyx_t_43 = 2;
    } else if (unlikely(__pyx_t_42 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_43 = 2;
    if (unlikely(__pyx_t_43 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_43);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_16 = (((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_40, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_41, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_42, __pyx_pybuffernd_seg.diminfo[2].strides)) == __pyx_v_label) != 0);
    if (__pyx_t_16) {
    } else {
      __pyx_t_6 = __pyx_t_16;
      goto __pyx_L24_bool_binop_done;
    }
    __pyx_t_43 = __pyx_v_z;
    __pyx_t_44 = __pyx_v_y;
    __pyx_t_45 = (__pyx_v_x + 1);
    __pyx_t_46 = -1;
    if (__pyx_t_43 &lt; 0) {
      __pyx_t_43 += __pyx_pybuffernd_mask.diminfo[0].shape;
      if (unlikely(__pyx_t_43 &lt; 0)) __pyx_t_46 = 0;
    } else if (unlikely(__pyx_t_43 &gt;= __pyx_pybuffernd_mask.diminfo[0].shape)) __pyx_t_46 = 0;
    if (__pyx_t_44 &lt; 0) {
      __pyx_t_44 += __pyx_pybuffernd_mask.diminfo[1].shape;
      if (unlikely(__pyx_t_44 &lt; 0)) __pyx_t_46 = 1;
    } else if (unlikely(__pyx_t_44 &gt;= __pyx_pybuffernd_mask.diminfo[1].shape)) __pyx_t_46 = 1;
    if (__pyx_t_45 &lt; 0) {
      __pyx_t_45 += __pyx_pybuffernd_mask.diminfo[2].shape;
      if (unlikely(__pyx_t_45 &lt; 0)) __pyx_t_46 = 2;
    } else if (unlikely(__pyx_t_45 &gt;= __pyx_pybuffernd_mask.diminfo[2].shape)) __pyx_t_46 = 2;
    if (unlikely(__pyx_t_46 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_46);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_16 = ((!((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint8_t *, __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_mask.diminfo[0].strides, __pyx_t_44, __pyx_pybuffernd_mask.diminfo[1].strides, __pyx_t_45, __pyx_pybuffernd_mask.diminfo[2].strides)) != 0)) != 0);
    __pyx_t_6 = __pyx_t_16;
    __pyx_L24_bool_binop_done:;
    if (__pyx_t_6) {
</pre><pre class='cython line score-17' onclick='toggleDiv(this)'>+38:             seeds.append((z,y,x+1))</pre>
<pre class='cython code score-17'>      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_z);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_y);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((__pyx_v_x + 1));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_4);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 2, __pyx_t_2);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
      __pyx_t_4 = 0;
      __pyx_t_1 = 0;
      __pyx_t_2 = 0;
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyList_Append</span>(__pyx_v_seeds, __pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L23;
    }
    __pyx_L23:;
</pre><pre class='cython line score-4' onclick='toggleDiv(this)'>+39:         if x-1&gt;=0    and seg[z,y,x-1] == label and not mask[z,y,x-1] :</pre>
<pre class='cython code score-4'>    __pyx_t_16 = (((__pyx_v_x - 1) &gt;= 0) != 0);
    if (__pyx_t_16) {
    } else {
      __pyx_t_6 = __pyx_t_16;
      goto __pyx_L28_bool_binop_done;
    }
    __pyx_t_46 = __pyx_v_z;
    __pyx_t_47 = __pyx_v_y;
    __pyx_t_48 = (__pyx_v_x - 1);
    __pyx_t_49 = -1;
    if (__pyx_t_46 &lt; 0) {
      __pyx_t_46 += __pyx_pybuffernd_seg.diminfo[0].shape;
      if (unlikely(__pyx_t_46 &lt; 0)) __pyx_t_49 = 0;
    } else if (unlikely(__pyx_t_46 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_49 = 0;
    if (__pyx_t_47 &lt; 0) {
      __pyx_t_47 += __pyx_pybuffernd_seg.diminfo[1].shape;
      if (unlikely(__pyx_t_47 &lt; 0)) __pyx_t_49 = 1;
    } else if (unlikely(__pyx_t_47 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_49 = 1;
    if (__pyx_t_48 &lt; 0) {
      __pyx_t_48 += __pyx_pybuffernd_seg.diminfo[2].shape;
      if (unlikely(__pyx_t_48 &lt; 0)) __pyx_t_49 = 2;
    } else if (unlikely(__pyx_t_48 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_49 = 2;
    if (unlikely(__pyx_t_49 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_49);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_16 = (((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_46, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_47, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_48, __pyx_pybuffernd_seg.diminfo[2].strides)) == __pyx_v_label) != 0);
    if (__pyx_t_16) {
    } else {
      __pyx_t_6 = __pyx_t_16;
      goto __pyx_L28_bool_binop_done;
    }
    __pyx_t_49 = __pyx_v_z;
    __pyx_t_50 = __pyx_v_y;
    __pyx_t_51 = (__pyx_v_x - 1);
    __pyx_t_52 = -1;
    if (__pyx_t_49 &lt; 0) {
      __pyx_t_49 += __pyx_pybuffernd_mask.diminfo[0].shape;
      if (unlikely(__pyx_t_49 &lt; 0)) __pyx_t_52 = 0;
    } else if (unlikely(__pyx_t_49 &gt;= __pyx_pybuffernd_mask.diminfo[0].shape)) __pyx_t_52 = 0;
    if (__pyx_t_50 &lt; 0) {
      __pyx_t_50 += __pyx_pybuffernd_mask.diminfo[1].shape;
      if (unlikely(__pyx_t_50 &lt; 0)) __pyx_t_52 = 1;
    } else if (unlikely(__pyx_t_50 &gt;= __pyx_pybuffernd_mask.diminfo[1].shape)) __pyx_t_52 = 1;
    if (__pyx_t_51 &lt; 0) {
      __pyx_t_51 += __pyx_pybuffernd_mask.diminfo[2].shape;
      if (unlikely(__pyx_t_51 &lt; 0)) __pyx_t_52 = 2;
    } else if (unlikely(__pyx_t_51 &gt;= __pyx_pybuffernd_mask.diminfo[2].shape)) __pyx_t_52 = 2;
    if (unlikely(__pyx_t_52 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_52);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_16 = ((!((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint8_t *, __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.buf, __pyx_t_49, __pyx_pybuffernd_mask.diminfo[0].strides, __pyx_t_50, __pyx_pybuffernd_mask.diminfo[1].strides, __pyx_t_51, __pyx_pybuffernd_mask.diminfo[2].strides)) != 0)) != 0);
    __pyx_t_6 = __pyx_t_16;
    __pyx_L28_bool_binop_done:;
    if (__pyx_t_6) {
</pre><pre class='cython line score-17' onclick='toggleDiv(this)'>+40:             seeds.append((z,y,x-1))</pre>
<pre class='cython code score-17'>      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_z);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_y);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((__pyx_v_x - 1));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_3);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_2);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 2, __pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      __pyx_t_3 = 0;
      __pyx_t_2 = 0;
      __pyx_t_1 = 0;
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyList_Append</span>(__pyx_v_seeds, __pyx_t_4);<span class='error_goto'> if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      goto __pyx_L27;
    }
    __pyx_L27:;
  }
</pre><pre class='cython line score-10' onclick='toggleDiv(this)'>+41:     return seg2, mask</pre>
<pre class='cython code score-10'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_seg2));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_v_seg2));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_seg2));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_mask));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, ((PyObject *)__pyx_v_mask));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_mask));
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;
</pre><pre class='cython line score-0'>&#xA0;42: </pre>
<pre class='cython line score-0'>&#xA0;43: #%% relabel by connectivity analysis</pre>
<pre class='cython line score-46' onclick='toggleDiv(this)'>+44: def relabel1N(np.ndarray[np.uint32_t, ndim=3] seg):</pre>
<pre class='cython code score-46'>/* Python wrapper */
static PyObject *__pyx_pw_11pywatershed_9c_relabel_3relabel1N(PyObject *__pyx_self, PyObject *__pyx_v_seg); /*proto*/
static PyMethodDef __pyx_mdef_11pywatershed_9c_relabel_3relabel1N = {"relabel1N", (PyCFunction)__pyx_pw_11pywatershed_9c_relabel_3relabel1N, METH_O, 0};
static PyObject *__pyx_pw_11pywatershed_9c_relabel_3relabel1N(PyObject *__pyx_self, PyObject *__pyx_v_seg) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("relabel1N (wrapper)", 0);
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_seg), __pyx_ptype_5numpy_ndarray, 1, "seg", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_11pywatershed_9c_relabel_2relabel1N(__pyx_self, ((PyArrayObject *)__pyx_v_seg));
  CYTHON_UNUSED int __pyx_lineno = 0;
  CYTHON_UNUSED const char *__pyx_filename = NULL;
  CYTHON_UNUSED int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11pywatershed_9c_relabel_2relabel1N(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_seg) {
  PyArrayObject *__pyx_v_mask = 0;
  PyArrayObject *__pyx_v_seg2 = 0;
  __pyx_t_5numpy_uint32_t __pyx_v_relid;
  __pyx_t_5numpy_uint32_t __pyx_v_z;
  __pyx_t_5numpy_uint32_t __pyx_v_y;
  __pyx_t_5numpy_uint32_t __pyx_v_x;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_mask;
  __Pyx_Buffer __pyx_pybuffer_mask;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_seg;
  __Pyx_Buffer __pyx_pybuffer_seg;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_seg2;
  __Pyx_Buffer __pyx_pybuffer_seg2;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("relabel1N", 0);
  __pyx_pybuffer_mask.pybuffer.buf = NULL;
  __pyx_pybuffer_mask.refcount = 0;
  __pyx_pybuffernd_mask.data = NULL;
  __pyx_pybuffernd_mask.rcbuffer = &amp;__pyx_pybuffer_mask;
  __pyx_pybuffer_seg2.pybuffer.buf = NULL;
  __pyx_pybuffer_seg2.refcount = 0;
  __pyx_pybuffernd_seg2.data = NULL;
  __pyx_pybuffernd_seg2.rcbuffer = &amp;__pyx_pybuffer_seg2;
  __pyx_pybuffer_seg.pybuffer.buf = NULL;
  __pyx_pybuffer_seg.refcount = 0;
  __pyx_pybuffernd_seg.data = NULL;
  __pyx_pybuffernd_seg.rcbuffer = &amp;__pyx_pybuffer_seg;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_seg, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_seg.diminfo[0].strides = __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_seg.diminfo[0].shape = __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_seg.diminfo[1].strides = __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_seg.diminfo[1].shape = __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_seg.diminfo[2].strides = __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_seg.diminfo[2].shape = __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.shape[2];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_24);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_25);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_26);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_27);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_29);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pywatershed.c_relabel.relabel1N", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_mask);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_seg2);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__9 = <span class='py_c_api'>PyTuple_Pack</span>(7, __pyx_n_s_seg, __pyx_n_s_mask, __pyx_n_s_seg2, __pyx_n_s_relid, __pyx_n_s_z, __pyx_n_s_y, __pyx_n_s_x);<span class='error_goto'> if (unlikely(!__pyx_tuple__9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__9);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_11pywatershed_9c_relabel_3relabel1N, NULL, __pyx_n_s_pywatershed_c_relabel);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_relabel1N, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__10 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(1, 0, 7, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__9, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_usr_people_nturner_bin_pywaters, __pyx_n_s_relabel1N, 44, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='cython line score-2' onclick='toggleDiv(this)'>+45:     print 'relabel by connectivity analysis ...'</pre>
<pre class='cython code score-2'>  if (<span class='pyx_c_api'>__Pyx_PrintOne</span>(0, __pyx_kp_s_relabel_by_connectivity_analysis) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='cython line score-0'>&#xA0;46:     # masker for visiting</pre>
<pre class='cython line score-0'>&#xA0;47:     cdef np.ndarray[np.uint8_t,    ndim=3, cast=True] mask</pre>
<pre class='cython line score-0'>&#xA0;48: #    mask = np.zeros(seg.shape, dtype=np.bool)</pre>
<pre class='cython line score-25' onclick='toggleDiv(this)'>+49:     mask = (seg==0)</pre>
<pre class='cython code score-25'>  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_seg), __pyx_int_0, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_2, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 1, __pyx_stack);
    if (unlikely(__pyx_t_3 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_4, &amp;__pyx_t_5, &amp;__pyx_t_6);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_mask, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 1, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_4); Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_4, __pyx_t_5, __pyx_t_6);
      }
    }
    __pyx_pybuffernd_mask.diminfo[0].strides = __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_mask.diminfo[0].shape = __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_mask.diminfo[1].strides = __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_mask.diminfo[1].shape = __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_mask.diminfo[2].strides = __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_mask.diminfo[2].shape = __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.shape[2];
    if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_2 = 0;
  __pyx_v_mask = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='cython line score-0'>&#xA0;50: </pre>
<pre class='cython line score-34' onclick='toggleDiv(this)'>+51:     cdef np.ndarray[np.uint32_t, ndim=3] seg2 = np.copy(seg)   # change to np.zeros ?</pre>
<pre class='cython code score-34'>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_copy);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
    __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
    if (likely(__pyx_t_7)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
    }
  }
  if (!__pyx_t_7) {
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_8, ((PyObject *)__pyx_v_seg));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else {
    __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_7); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7); __pyx_t_7 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_seg));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0+1, ((PyObject *)__pyx_v_seg));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_seg));
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_8, __pyx_t_9, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_10 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_10, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) {
      __pyx_v_seg2 = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_seg2.diminfo[0].strides = __pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_seg2.diminfo[0].shape = __pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_seg2.diminfo[1].strides = __pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_seg2.diminfo[1].shape = __pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_seg2.diminfo[2].strides = __pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_seg2.diminfo[2].shape = __pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer.shape[2];
    }
  }
  __pyx_t_10 = 0;
  __pyx_v_seg2 = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='cython line score-0'>&#xA0;52:     # relabel ID</pre>
<pre class='cython line score-0' onclick='toggleDiv(this)'>+53:     cdef np.uint32_t relid = 0</pre>
<pre class='cython code score-0'>  __pyx_v_relid = 0;
</pre><pre class='cython line score-0'>&#xA0;54:     cdef np.uint32_t z,y,x</pre>
<pre class='cython line score-0' onclick='toggleDiv(this)'>+55:     for z in xrange(seg.shape[0]):</pre>
<pre class='cython code score-0'>  __pyx_t_11 = (__pyx_v_seg-&gt;dimensions[0]);
  for (__pyx_t_12 = 0; __pyx_t_12 &lt; __pyx_t_11; __pyx_t_12+=1) {
    __pyx_v_z = __pyx_t_12;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+56:         for y in xrange(seg.shape[1]):</pre>
<pre class='cython code score-0'>    __pyx_t_13 = (__pyx_v_seg-&gt;dimensions[1]);
    for (__pyx_t_14 = 0; __pyx_t_14 &lt; __pyx_t_13; __pyx_t_14+=1) {
      __pyx_v_y = __pyx_t_14;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+57:             for x in xrange(seg.shape[2]):</pre>
<pre class='cython code score-0'>      __pyx_t_15 = (__pyx_v_seg-&gt;dimensions[2]);
      for (__pyx_t_16 = 0; __pyx_t_16 &lt; __pyx_t_15; __pyx_t_16+=1) {
        __pyx_v_x = __pyx_t_16;
</pre><pre class='cython line score-2' onclick='toggleDiv(this)'>+58:                 if mask[z,y,x]:</pre>
<pre class='cython code score-2'>        __pyx_t_17 = __pyx_v_z;
        __pyx_t_18 = __pyx_v_y;
        __pyx_t_19 = __pyx_v_x;
        __pyx_t_3 = -1;
        if (unlikely(__pyx_t_17 &gt;= (size_t)__pyx_pybuffernd_mask.diminfo[0].shape)) __pyx_t_3 = 0;
        if (unlikely(__pyx_t_18 &gt;= (size_t)__pyx_pybuffernd_mask.diminfo[1].shape)) __pyx_t_3 = 1;
        if (unlikely(__pyx_t_19 &gt;= (size_t)__pyx_pybuffernd_mask.diminfo[2].shape)) __pyx_t_3 = 2;
        if (unlikely(__pyx_t_3 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_20 = ((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint8_t *, __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_mask.diminfo[0].strides, __pyx_t_18, __pyx_pybuffernd_mask.diminfo[1].strides, __pyx_t_19, __pyx_pybuffernd_mask.diminfo[2].strides)) != 0);
        if (__pyx_t_20) {
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+59:                     continue</pre>
<pre class='cython code score-0'>          goto __pyx_L7_continue;
        }
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+60:                 relid += 1</pre>
<pre class='cython code score-0'>        __pyx_v_relid = (__pyx_v_relid + 1);
</pre><pre class='cython line score-0'>&#xA0;61:                 # flood fill</pre>
<pre class='cython line score-124' onclick='toggleDiv(this)'>+62:                 seg2, mask = dfs(seg, seg2, mask, relid, seg[z,y,x], z,y,x)</pre>
<pre class='cython code score-124'>        __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_dfs);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
        __pyx_t_9 = __Pyx_PyInt_From_npy_uint32(__pyx_v_relid);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
        __pyx_t_21 = __pyx_v_z;
        __pyx_t_22 = __pyx_v_y;
        __pyx_t_23 = __pyx_v_x;
        __pyx_t_3 = -1;
        if (unlikely(__pyx_t_21 &gt;= (size_t)__pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_3 = 0;
        if (unlikely(__pyx_t_22 &gt;= (size_t)__pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_3 = 1;
        if (unlikely(__pyx_t_23 &gt;= (size_t)__pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_3 = 2;
        if (unlikely(__pyx_t_3 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_7 = __Pyx_PyInt_From_npy_uint32((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_22, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_23, __pyx_pybuffernd_seg.diminfo[2].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        __pyx_t_24 = __Pyx_PyInt_From_npy_uint32(__pyx_v_z);<span class='error_goto'> if (unlikely(!__pyx_t_24)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_24);
        __pyx_t_25 = __Pyx_PyInt_From_npy_uint32(__pyx_v_y);<span class='error_goto'> if (unlikely(!__pyx_t_25)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
        __pyx_t_26 = __Pyx_PyInt_From_npy_uint32(__pyx_v_x);<span class='error_goto'> if (unlikely(!__pyx_t_26)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_26);
        __pyx_t_27 = NULL;
        __pyx_t_28 = 0;
        if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
          __pyx_t_27 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
          if (likely(__pyx_t_27)) {
            PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_27);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
            __pyx_t_28 = 1;
          }
        }
        __pyx_t_29 = <span class='py_c_api'>PyTuple_New</span>(8+__pyx_t_28);<span class='error_goto'> if (unlikely(!__pyx_t_29)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_29);
        if (__pyx_t_27) {
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 0, __pyx_t_27); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_27); __pyx_t_27 = NULL;
        }
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_seg));
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 0+__pyx_t_28, ((PyObject *)__pyx_v_seg));
        <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_seg));
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_seg2));
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 1+__pyx_t_28, ((PyObject *)__pyx_v_seg2));
        <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_seg2));
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_mask));
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 2+__pyx_t_28, ((PyObject *)__pyx_v_mask));
        <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_mask));
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 3+__pyx_t_28, __pyx_t_9);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 4+__pyx_t_28, __pyx_t_7);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 5+__pyx_t_28, __pyx_t_24);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_24);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 6+__pyx_t_28, __pyx_t_25);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_25);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 7+__pyx_t_28, __pyx_t_26);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_26);
        __pyx_t_9 = 0;
        __pyx_t_7 = 0;
        __pyx_t_24 = 0;
        __pyx_t_25 = 0;
        __pyx_t_26 = 0;
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_8, __pyx_t_29, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_29); __pyx_t_29 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        if ((likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1))) || (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1))) {
          PyObject* sequence = __pyx_t_1;
          #if CYTHON_COMPILING_IN_CPYTHON
          Py_ssize_t size = Py_SIZE(sequence);
          #else
          Py_ssize_t size = <span class='py_c_api'>PySequence_Size</span>(sequence);
          #endif
          if (unlikely(size != 2)) {
            if (size &gt; 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
            else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          #if CYTHON_COMPILING_IN_CPYTHON
          if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(sequence))) {
            __pyx_t_8 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
            __pyx_t_29 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
          } else {
            __pyx_t_8 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
            __pyx_t_29 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
          }
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_29);
          #else
          __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          __pyx_t_29 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_29)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_29);
          #endif
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        } else {
          Py_ssize_t index = -1;
          __pyx_t_26 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_26)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_26);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_30 = Py_TYPE(__pyx_t_26)-&gt;tp_iternext;
          index = 0; __pyx_t_8 = __pyx_t_30(__pyx_t_26); if (unlikely(!__pyx_t_8)) goto __pyx_L10_unpacking_failed;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          index = 1; __pyx_t_29 = __pyx_t_30(__pyx_t_26); if (unlikely(!__pyx_t_29)) goto __pyx_L10_unpacking_failed;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_29);
          if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_30(__pyx_t_26), 2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          __pyx_t_30 = NULL;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
          goto __pyx_L11_unpacking_done;
          __pyx_L10_unpacking_failed:;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
          __pyx_t_30 = NULL;
          if (<span class='pyx_c_api'>__Pyx_IterFinish</span>() == 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          __pyx_L11_unpacking_done:;
        }
        if (!(likely(((__pyx_t_8) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_8, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        if (!(likely(((__pyx_t_29) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_29, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        __pyx_t_10 = ((PyArrayObject *)__pyx_t_8);
        {
          __Pyx_BufFmt_StackElem __pyx_stack[1];
          <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer);
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_10, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack);
          if (unlikely(__pyx_t_3 &lt; 0)) {
            <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_6, &amp;__pyx_t_5, &amp;__pyx_t_4);
            if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_seg2, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) {
              Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_4);
              <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
            } else {
              <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_6, __pyx_t_5, __pyx_t_4);
            }
          }
          __pyx_pybuffernd_seg2.diminfo[0].strides = __pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_seg2.diminfo[0].shape = __pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_seg2.diminfo[1].strides = __pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_seg2.diminfo[1].shape = __pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_seg2.diminfo[2].strides = __pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_seg2.diminfo[2].shape = __pyx_pybuffernd_seg2.rcbuffer-&gt;pybuffer.shape[2];
          if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_10 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_seg2, ((PyArrayObject *)__pyx_t_8));
        __pyx_t_8 = 0;
        __pyx_t_2 = ((PyArrayObject *)__pyx_t_29);
        {
          __Pyx_BufFmt_StackElem __pyx_stack[1];
          <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer);
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_2, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 1, __pyx_stack);
          if (unlikely(__pyx_t_3 &lt; 0)) {
            <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_4, &amp;__pyx_t_5, &amp;__pyx_t_6);
            if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_mask, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 1, __pyx_stack) == -1)) {
              Py_XDECREF(__pyx_t_4); Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6);
              <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
            } else {
              <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_4, __pyx_t_5, __pyx_t_6);
            }
          }
          __pyx_pybuffernd_mask.diminfo[0].strides = __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_mask.diminfo[0].shape = __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_mask.diminfo[1].strides = __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_mask.diminfo[1].shape = __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_mask.diminfo[2].strides = __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_mask.diminfo[2].shape = __pyx_pybuffernd_mask.rcbuffer-&gt;pybuffer.shape[2];
          if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_2 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_mask, ((PyArrayObject *)__pyx_t_29));
        __pyx_t_29 = 0;
        __pyx_L7_continue:;
      }
    }
  }
</pre><pre class='cython line score-97' onclick='toggleDiv(this)'>+63:     print "number of segments: {}--&gt;{}".format( np.unique(seg).shape[0], np.unique(seg2).shape[0] )</pre>
<pre class='cython code score-97'>  __pyx_t_29 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_kp_s_number_of_segments, __pyx_n_s_format);<span class='error_goto'> if (unlikely(!__pyx_t_29)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_29);
  __pyx_t_26 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_26)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_26);
  __pyx_t_25 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_26, __pyx_n_s_unique);<span class='error_goto'> if (unlikely(!__pyx_t_25)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
  __pyx_t_26 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_25))) {
    __pyx_t_26 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_25);
    if (likely(__pyx_t_26)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_25);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_26);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_25, function);
    }
  }
  if (!__pyx_t_26) {
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_25, ((PyObject *)__pyx_v_seg));<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  } else {
    __pyx_t_24 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_24)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_24);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_24, 0, __pyx_t_26); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_26); __pyx_t_26 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_seg));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_24, 0+1, ((PyObject *)__pyx_v_seg));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_seg));
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_25, __pyx_t_24, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_24); __pyx_t_24 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
  __pyx_t_25 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_25)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_25, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(__pyx_t_8 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
  __pyx_t_24 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_24)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_24);
  __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_24, __pyx_n_s_unique);<span class='error_goto'> if (unlikely(!__pyx_t_26)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_26);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_24); __pyx_t_24 = 0;
  __pyx_t_24 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_26))) {
    __pyx_t_24 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_26);
    if (likely(__pyx_t_24)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_26);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_24);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_26, function);
    }
  }
  if (!__pyx_t_24) {
    __pyx_t_25 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_26, ((PyObject *)__pyx_v_seg2));<span class='error_goto'> if (unlikely(!__pyx_t_25)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
  } else {
    __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_24); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_24); __pyx_t_24 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_seg2));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0+1, ((PyObject *)__pyx_v_seg2));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_seg2));
    __pyx_t_25 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_26, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_25)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
  __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_25, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_26)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_26);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
  __pyx_t_25 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_26, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(__pyx_t_25 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
  __pyx_t_26 = NULL;
  __pyx_t_28 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_29))) {
    __pyx_t_26 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_29);
    if (likely(__pyx_t_26)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_29);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_26);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_29, function);
      __pyx_t_28 = 1;
    }
  }
  __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_28);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (__pyx_t_26) {
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_26); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_26); __pyx_t_26 = NULL;
  }
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0+__pyx_t_28, __pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 1+__pyx_t_28, __pyx_t_25);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_25);
  __pyx_t_8 = 0;
  __pyx_t_25 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_29, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_29); __pyx_t_29 = 0;
  if (<span class='pyx_c_api'>__Pyx_PrintOne</span>(0, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='cython line score-2' onclick='toggleDiv(this)'>+64:     return seg2</pre>
<pre class='cython code score-2'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_seg2));
  __pyx_r = ((PyObject *)__pyx_v_seg2);
  goto __pyx_L0;
</pre><pre class='cython line score-0'>&#xA0;65: </pre>
<pre class='cython line score-66' onclick='toggleDiv(this)'>+66: def add_item(dict con, frozenset key, float value):</pre>
<pre class='cython code score-66'>/* Python wrapper */
static PyObject *__pyx_pw_11pywatershed_9c_relabel_5add_item(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_11pywatershed_9c_relabel_5add_item = {"add_item", (PyCFunction)__pyx_pw_11pywatershed_9c_relabel_5add_item, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_11pywatershed_9c_relabel_5add_item(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_con = 0;
  PyObject *__pyx_v_key = 0;
  float __pyx_v_value;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("add_item (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_con,&amp;__pyx_n_s_key,&amp;__pyx_n_s_value,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_con)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_key)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("add_item", 1, 3, 3, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_value)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("add_item", 1, 3, 3, 2); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "add_item") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_con = ((PyObject*)values[0]);
    __pyx_v_key = ((PyObject*)values[1]);
    __pyx_v_value = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[2]);<span class='error_goto'> if (unlikely((__pyx_v_value == (float)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("add_item", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pywatershed.c_relabel.add_item", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_con), (&amp;PyDict_Type), 1, "con", 1))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_key), (&amp;PyFrozenSet_Type), 1, "key", 1))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_11pywatershed_9c_relabel_4add_item(__pyx_self, __pyx_v_con, __pyx_v_key, __pyx_v_value);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11pywatershed_9c_relabel_4add_item(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_con, PyObject *__pyx_v_key, float __pyx_v_value) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("add_item", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pywatershed.c_relabel.add_item", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__11 = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_n_s_con, __pyx_n_s_key, __pyx_n_s_value);<span class='error_goto'> if (unlikely(!__pyx_tuple__11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__11);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__11);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_11pywatershed_9c_relabel_5add_item, NULL, __pyx_n_s_pywatershed_c_relabel);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_add_item, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__12 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(3, 0, 3, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__11, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_usr_people_nturner_bin_pywaters, __pyx_n_s_add_item, 66, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='cython line score-32' onclick='toggleDiv(this)'>+67:     if (not con.has_key(key)) or con[key]&lt;value:</pre>
<pre class='cython code score-32'>  if (unlikely(__pyx_v_con == Py_None)) {
    <span class='py_c_api'>PyErr_Format</span>(PyExc_AttributeError, "'NoneType' object has no attribute '%s'", "has_key");
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_2 = <span class='py_c_api'>PyDict_Contains</span>(__pyx_v_con, __pyx_v_key);<span class='error_goto'> if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_3 = ((!(__pyx_t_2 != 0)) != 0);
  if (!__pyx_t_3) {
  } else {
    __pyx_t_1 = __pyx_t_3;
    goto __pyx_L4_bool_binop_done;
  }
  if (unlikely(__pyx_v_con == Py_None)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_GetItem</span>(__pyx_v_con, __pyx_v_key);<span class='error_goto'> if (unlikely(__pyx_t_4 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_value);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_4, __pyx_t_5, Py_LT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(__pyx_t_3 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_1 = __pyx_t_3;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_1) {
</pre><pre class='cython line score-16' onclick='toggleDiv(this)'>+68:         con[key] = value</pre>
<pre class='cython code score-16'>    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_value);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    if (unlikely(__pyx_v_con == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_v_con, __pyx_v_key, __pyx_t_6) &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='cython line score-2' onclick='toggleDiv(this)'>+69:     return con</pre>
<pre class='cython code score-2'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_con);
  __pyx_r = __pyx_v_con;
  goto __pyx_L0;
</pre><pre class='cython line score-0'>&#xA0;70: #%% estimate the connection probability, construct the dendrogram</pre>
<pre class='cython line score-70' onclick='toggleDiv(this)'>+71: def build_region_graph(np.ndarray[np.uint32_t, ndim=3] seg,\</pre>
<pre class='cython code score-70'>/* Python wrapper */
static PyObject *__pyx_pw_11pywatershed_9c_relabel_7build_region_graph(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_11pywatershed_9c_relabel_7build_region_graph = {"build_region_graph", (PyCFunction)__pyx_pw_11pywatershed_9c_relabel_7build_region_graph, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_11pywatershed_9c_relabel_7build_region_graph(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_seg = 0;
  PyArrayObject *__pyx_v_affin = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("build_region_graph (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_seg,&amp;__pyx_n_s_affin,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_seg)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_affin)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("build_region_graph", 1, 2, 2, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "build_region_graph") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_seg = ((PyArrayObject *)values[0]);
    __pyx_v_affin = ((PyArrayObject *)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("build_region_graph", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pywatershed.c_relabel.build_region_graph", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_seg), __pyx_ptype_5numpy_ndarray, 1, "seg", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_affin), __pyx_ptype_5numpy_ndarray, 1, "affin", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_11pywatershed_9c_relabel_6build_region_graph(__pyx_self, __pyx_v_seg, __pyx_v_affin);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11pywatershed_9c_relabel_6build_region_graph(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_seg, PyArrayObject *__pyx_v_affin) {
  PyObject *__pyx_v_con = 0;
  int __pyx_v_Nz;
  int __pyx_v_Ny;
  int __pyx_v_Nx;
  int __pyx_v_z;
  int __pyx_v_y;
  int __pyx_v_x;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_affin;
  __Pyx_Buffer __pyx_pybuffer_affin;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_seg;
  __Pyx_Buffer __pyx_pybuffer_seg;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("build_region_graph", 0);
  __pyx_pybuffer_seg.pybuffer.buf = NULL;
  __pyx_pybuffer_seg.refcount = 0;
  __pyx_pybuffernd_seg.data = NULL;
  __pyx_pybuffernd_seg.rcbuffer = &amp;__pyx_pybuffer_seg;
  __pyx_pybuffer_affin.pybuffer.buf = NULL;
  __pyx_pybuffer_affin.refcount = 0;
  __pyx_pybuffernd_affin.data = NULL;
  __pyx_pybuffernd_affin.rcbuffer = &amp;__pyx_pybuffer_affin;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_seg, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_seg.diminfo[0].strides = __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_seg.diminfo[0].shape = __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_seg.diminfo[1].strides = __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_seg.diminfo[1].shape = __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_seg.diminfo[2].strides = __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_seg.diminfo[2].shape = __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.shape[2];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_affin.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_affin, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float32_t, PyBUF_FORMAT| PyBUF_STRIDES, 4, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_affin.diminfo[0].strides = __pyx_pybuffernd_affin.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_affin.diminfo[0].shape = __pyx_pybuffernd_affin.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_affin.diminfo[1].strides = __pyx_pybuffernd_affin.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_affin.diminfo[1].shape = __pyx_pybuffernd_affin.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_affin.diminfo[2].strides = __pyx_pybuffernd_affin.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_affin.diminfo[2].shape = __pyx_pybuffernd_affin.rcbuffer-&gt;pybuffer.shape[2]; __pyx_pybuffernd_affin.diminfo[3].strides = __pyx_pybuffernd_affin.rcbuffer-&gt;pybuffer.strides[3]; __pyx_pybuffernd_affin.diminfo[3].shape = __pyx_pybuffernd_affin.rcbuffer-&gt;pybuffer.shape[3];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_23);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_27);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_31);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_32);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_38);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_affin.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pywatershed.c_relabel.build_region_graph", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_affin.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_con);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__13 = <span class='py_c_api'>PyTuple_Pack</span>(9, __pyx_n_s_seg, __pyx_n_s_affin, __pyx_n_s_con, __pyx_n_s_Nz, __pyx_n_s_Ny, __pyx_n_s_Nx, __pyx_n_s_z, __pyx_n_s_y, __pyx_n_s_x);<span class='error_goto'> if (unlikely(!__pyx_tuple__13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__13);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__13);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_11pywatershed_9c_relabel_7build_region_graph, NULL, __pyx_n_s_pywatershed_c_relabel);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_build_region_graph, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='cython line score-0'>&#xA0;72:                        np.ndarray[np.float32_t,  ndim=4] affin):</pre>
<pre class='cython line score-5' onclick='toggleDiv(this)'>+73:     cdef dict con = {}</pre>
<pre class='cython code score-5'>  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_con = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+74:     cdef int Nz = seg.shape[0]</pre>
<pre class='cython code score-0'>  __pyx_v_Nz = (__pyx_v_seg-&gt;dimensions[0]);
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+75:     cdef int Ny = seg.shape[1]</pre>
<pre class='cython code score-0'>  __pyx_v_Ny = (__pyx_v_seg-&gt;dimensions[1]);
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+76:     cdef int Nx = seg.shape[2]</pre>
<pre class='cython code score-0'>  __pyx_v_Nx = (__pyx_v_seg-&gt;dimensions[2]);
</pre><pre class='cython line score-0'>&#xA0;77:     cdef int z,y,x</pre>
<pre class='cython line score-0' onclick='toggleDiv(this)'>+78:     for z in xrange(1, Nz):</pre>
<pre class='cython code score-0'>  __pyx_t_2 = __pyx_v_Nz;
  for (__pyx_t_3 = 1; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_z = __pyx_t_3;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+79:         for y in xrange(1, Ny):</pre>
<pre class='cython code score-0'>    __pyx_t_4 = __pyx_v_Ny;
    for (__pyx_t_5 = 1; __pyx_t_5 &lt; __pyx_t_4; __pyx_t_5+=1) {
      __pyx_v_y = __pyx_t_5;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+80:             for x in xrange(1, Nx):</pre>
<pre class='cython code score-0'>      __pyx_t_6 = __pyx_v_Nx;
      for (__pyx_t_7 = 1; __pyx_t_7 &lt; __pyx_t_6; __pyx_t_7+=1) {
        __pyx_v_x = __pyx_t_7;
</pre><pre class='cython line score-2' onclick='toggleDiv(this)'>+81:                 if seg[z,y,x]:</pre>
<pre class='cython code score-2'>        __pyx_t_8 = __pyx_v_z;
        __pyx_t_9 = __pyx_v_y;
        __pyx_t_10 = __pyx_v_x;
        __pyx_t_11 = -1;
        if (__pyx_t_8 &lt; 0) {
          __pyx_t_8 += __pyx_pybuffernd_seg.diminfo[0].shape;
          if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_11 = 0;
        } else if (unlikely(__pyx_t_8 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_11 = 0;
        if (__pyx_t_9 &lt; 0) {
          __pyx_t_9 += __pyx_pybuffernd_seg.diminfo[1].shape;
          if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_11 = 1;
        } else if (unlikely(__pyx_t_9 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_11 = 1;
        if (__pyx_t_10 &lt; 0) {
          __pyx_t_10 += __pyx_pybuffernd_seg.diminfo[2].shape;
          if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_11 = 2;
        } else if (unlikely(__pyx_t_10 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_11 = 2;
        if (unlikely(__pyx_t_11 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_11);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_12 = ((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_8, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_9, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_10, __pyx_pybuffernd_seg.diminfo[2].strides)) != 0);
        if (__pyx_t_12) {
</pre><pre class='cython line score-6' onclick='toggleDiv(this)'>+82:                     if seg[z-1,y,x] and seg[z,y,x]!=seg[z-1,y,x]:</pre>
<pre class='cython code score-6'>          __pyx_t_13 = (__pyx_v_z - 1);
          __pyx_t_11 = __pyx_v_y;
          __pyx_t_14 = __pyx_v_x;
          __pyx_t_15 = -1;
          if (__pyx_t_13 &lt; 0) {
            __pyx_t_13 += __pyx_pybuffernd_seg.diminfo[0].shape;
            if (unlikely(__pyx_t_13 &lt; 0)) __pyx_t_15 = 0;
          } else if (unlikely(__pyx_t_13 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_15 = 0;
          if (__pyx_t_11 &lt; 0) {
            __pyx_t_11 += __pyx_pybuffernd_seg.diminfo[1].shape;
            if (unlikely(__pyx_t_11 &lt; 0)) __pyx_t_15 = 1;
          } else if (unlikely(__pyx_t_11 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_15 = 1;
          if (__pyx_t_14 &lt; 0) {
            __pyx_t_14 += __pyx_pybuffernd_seg.diminfo[2].shape;
            if (unlikely(__pyx_t_14 &lt; 0)) __pyx_t_15 = 2;
          } else if (unlikely(__pyx_t_14 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_15 = 2;
          if (unlikely(__pyx_t_15 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_15);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_16 = ((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_11, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_14, __pyx_pybuffernd_seg.diminfo[2].strides)) != 0);
          if (__pyx_t_16) {
          } else {
            __pyx_t_12 = __pyx_t_16;
            goto __pyx_L11_bool_binop_done;
          }
          __pyx_t_15 = __pyx_v_z;
          __pyx_t_17 = __pyx_v_y;
          __pyx_t_18 = __pyx_v_x;
          __pyx_t_19 = -1;
          if (__pyx_t_15 &lt; 0) {
            __pyx_t_15 += __pyx_pybuffernd_seg.diminfo[0].shape;
            if (unlikely(__pyx_t_15 &lt; 0)) __pyx_t_19 = 0;
          } else if (unlikely(__pyx_t_15 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_19 = 0;
          if (__pyx_t_17 &lt; 0) {
            __pyx_t_17 += __pyx_pybuffernd_seg.diminfo[1].shape;
            if (unlikely(__pyx_t_17 &lt; 0)) __pyx_t_19 = 1;
          } else if (unlikely(__pyx_t_17 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_19 = 1;
          if (__pyx_t_18 &lt; 0) {
            __pyx_t_18 += __pyx_pybuffernd_seg.diminfo[2].shape;
            if (unlikely(__pyx_t_18 &lt; 0)) __pyx_t_19 = 2;
          } else if (unlikely(__pyx_t_18 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_19 = 2;
          if (unlikely(__pyx_t_19 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_19);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_20 = (__pyx_v_z - 1);
          __pyx_t_19 = __pyx_v_y;
          __pyx_t_21 = __pyx_v_x;
          __pyx_t_22 = -1;
          if (__pyx_t_20 &lt; 0) {
            __pyx_t_20 += __pyx_pybuffernd_seg.diminfo[0].shape;
            if (unlikely(__pyx_t_20 &lt; 0)) __pyx_t_22 = 0;
          } else if (unlikely(__pyx_t_20 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_22 = 0;
          if (__pyx_t_19 &lt; 0) {
            __pyx_t_19 += __pyx_pybuffernd_seg.diminfo[1].shape;
            if (unlikely(__pyx_t_19 &lt; 0)) __pyx_t_22 = 1;
          } else if (unlikely(__pyx_t_19 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_22 = 1;
          if (__pyx_t_21 &lt; 0) {
            __pyx_t_21 += __pyx_pybuffernd_seg.diminfo[2].shape;
            if (unlikely(__pyx_t_21 &lt; 0)) __pyx_t_22 = 2;
          } else if (unlikely(__pyx_t_21 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_22 = 2;
          if (unlikely(__pyx_t_22 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_22);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_16 = (((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_seg.diminfo[2].strides)) != (*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_21, __pyx_pybuffernd_seg.diminfo[2].strides))) != 0);
          __pyx_t_12 = __pyx_t_16;
          __pyx_L11_bool_binop_done:;
          if (__pyx_t_12) {
</pre><pre class='cython line score-58' onclick='toggleDiv(this)'>+83:                         con = add_item(con,frozenset([seg[z,y,x], seg[z-1,y,x]]), affin[2,z,y,x])</pre>
<pre class='cython code score-58'>            __pyx_t_23 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_add_item);<span class='error_goto'> if (unlikely(!__pyx_t_23)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_23);
            __pyx_t_22 = __pyx_v_z;
            __pyx_t_24 = __pyx_v_y;
            __pyx_t_25 = __pyx_v_x;
            __pyx_t_26 = -1;
            if (__pyx_t_22 &lt; 0) {
              __pyx_t_22 += __pyx_pybuffernd_seg.diminfo[0].shape;
              if (unlikely(__pyx_t_22 &lt; 0)) __pyx_t_26 = 0;
            } else if (unlikely(__pyx_t_22 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_26 = 0;
            if (__pyx_t_24 &lt; 0) {
              __pyx_t_24 += __pyx_pybuffernd_seg.diminfo[1].shape;
              if (unlikely(__pyx_t_24 &lt; 0)) __pyx_t_26 = 1;
            } else if (unlikely(__pyx_t_24 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_26 = 1;
            if (__pyx_t_25 &lt; 0) {
              __pyx_t_25 += __pyx_pybuffernd_seg.diminfo[2].shape;
              if (unlikely(__pyx_t_25 &lt; 0)) __pyx_t_26 = 2;
            } else if (unlikely(__pyx_t_25 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_26 = 2;
            if (unlikely(__pyx_t_26 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_26);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            __pyx_t_27 = __Pyx_PyInt_From_npy_uint32((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_24, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_25, __pyx_pybuffernd_seg.diminfo[2].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_27)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_27);
            __pyx_t_28 = (__pyx_v_z - 1);
            __pyx_t_26 = __pyx_v_y;
            __pyx_t_29 = __pyx_v_x;
            __pyx_t_30 = -1;
            if (__pyx_t_28 &lt; 0) {
              __pyx_t_28 += __pyx_pybuffernd_seg.diminfo[0].shape;
              if (unlikely(__pyx_t_28 &lt; 0)) __pyx_t_30 = 0;
            } else if (unlikely(__pyx_t_28 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_30 = 0;
            if (__pyx_t_26 &lt; 0) {
              __pyx_t_26 += __pyx_pybuffernd_seg.diminfo[1].shape;
              if (unlikely(__pyx_t_26 &lt; 0)) __pyx_t_30 = 1;
            } else if (unlikely(__pyx_t_26 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_30 = 1;
            if (__pyx_t_29 &lt; 0) {
              __pyx_t_29 += __pyx_pybuffernd_seg.diminfo[2].shape;
              if (unlikely(__pyx_t_29 &lt; 0)) __pyx_t_30 = 2;
            } else if (unlikely(__pyx_t_29 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_30 = 2;
            if (unlikely(__pyx_t_30 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_30);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            __pyx_t_31 = __Pyx_PyInt_From_npy_uint32((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_28, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_26, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_29, __pyx_pybuffernd_seg.diminfo[2].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_31)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_31);
            __pyx_t_32 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_32)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_32);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_32, 0, __pyx_t_27);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_27);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_32, 1, __pyx_t_31);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_31);
            __pyx_t_27 = 0;
            __pyx_t_31 = 0;
            __pyx_t_31 = <span class='pyx_c_api'>__Pyx_PyFrozenSet_New</span>(__pyx_t_32);<span class='error_goto'> if (unlikely(!__pyx_t_31)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_31);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_32); __pyx_t_32 = 0;
            __pyx_t_33 = 2;
            __pyx_t_30 = __pyx_v_z;
            __pyx_t_34 = __pyx_v_y;
            __pyx_t_35 = __pyx_v_x;
            __pyx_t_36 = -1;
            if (__pyx_t_33 &lt; 0) {
              __pyx_t_33 += __pyx_pybuffernd_affin.diminfo[0].shape;
              if (unlikely(__pyx_t_33 &lt; 0)) __pyx_t_36 = 0;
            } else if (unlikely(__pyx_t_33 &gt;= __pyx_pybuffernd_affin.diminfo[0].shape)) __pyx_t_36 = 0;
            if (__pyx_t_30 &lt; 0) {
              __pyx_t_30 += __pyx_pybuffernd_affin.diminfo[1].shape;
              if (unlikely(__pyx_t_30 &lt; 0)) __pyx_t_36 = 1;
            } else if (unlikely(__pyx_t_30 &gt;= __pyx_pybuffernd_affin.diminfo[1].shape)) __pyx_t_36 = 1;
            if (__pyx_t_34 &lt; 0) {
              __pyx_t_34 += __pyx_pybuffernd_affin.diminfo[2].shape;
              if (unlikely(__pyx_t_34 &lt; 0)) __pyx_t_36 = 2;
            } else if (unlikely(__pyx_t_34 &gt;= __pyx_pybuffernd_affin.diminfo[2].shape)) __pyx_t_36 = 2;
            if (__pyx_t_35 &lt; 0) {
              __pyx_t_35 += __pyx_pybuffernd_affin.diminfo[3].shape;
              if (unlikely(__pyx_t_35 &lt; 0)) __pyx_t_36 = 3;
            } else if (unlikely(__pyx_t_35 &gt;= __pyx_pybuffernd_affin.diminfo[3].shape)) __pyx_t_36 = 3;
            if (unlikely(__pyx_t_36 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_36);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            __pyx_t_32 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided4d(__pyx_t_5numpy_float32_t *, __pyx_pybuffernd_affin.rcbuffer-&gt;pybuffer.buf, __pyx_t_33, __pyx_pybuffernd_affin.diminfo[0].strides, __pyx_t_30, __pyx_pybuffernd_affin.diminfo[1].strides, __pyx_t_34, __pyx_pybuffernd_affin.diminfo[2].strides, __pyx_t_35, __pyx_pybuffernd_affin.diminfo[3].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_32)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_32);
            __pyx_t_27 = NULL;
            __pyx_t_37 = 0;
            if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_23))) {
              __pyx_t_27 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_23);
              if (likely(__pyx_t_27)) {
                PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_23);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_27);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_23, function);
                __pyx_t_37 = 1;
              }
            }
            __pyx_t_38 = <span class='py_c_api'>PyTuple_New</span>(3+__pyx_t_37);<span class='error_goto'> if (unlikely(!__pyx_t_38)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_38);
            if (__pyx_t_27) {
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_38, 0, __pyx_t_27); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_27); __pyx_t_27 = NULL;
            }
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_con);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_38, 0+__pyx_t_37, __pyx_v_con);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_con);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_38, 1+__pyx_t_37, __pyx_t_31);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_31);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_38, 2+__pyx_t_37, __pyx_t_32);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_32);
            __pyx_t_31 = 0;
            __pyx_t_32 = 0;
            __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_23, __pyx_t_38, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_38); __pyx_t_38 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_23); __pyx_t_23 = 0;
            if (!(likely(<span class='py_c_api'>PyDict_CheckExact</span>(__pyx_t_1))||((__pyx_t_1) == Py_None)||(<span class='py_c_api'>PyErr_Format</span>(PyExc_TypeError, "Expected %.16s, got %.200s", "dict", Py_TYPE(__pyx_t_1)-&gt;tp_name), 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_con, ((PyObject*)__pyx_t_1));
            __pyx_t_1 = 0;
            goto __pyx_L10;
          }
          __pyx_L10:;
</pre><pre class='cython line score-6' onclick='toggleDiv(this)'>+84:                     if seg[z,y-1,x] and seg[z,y,x]!=seg[z,y-1,x]:</pre>
<pre class='cython code score-6'>          __pyx_t_36 = __pyx_v_z;
          __pyx_t_39 = (__pyx_v_y - 1);
          __pyx_t_40 = __pyx_v_x;
          __pyx_t_41 = -1;
          if (__pyx_t_36 &lt; 0) {
            __pyx_t_36 += __pyx_pybuffernd_seg.diminfo[0].shape;
            if (unlikely(__pyx_t_36 &lt; 0)) __pyx_t_41 = 0;
          } else if (unlikely(__pyx_t_36 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_41 = 0;
          if (__pyx_t_39 &lt; 0) {
            __pyx_t_39 += __pyx_pybuffernd_seg.diminfo[1].shape;
            if (unlikely(__pyx_t_39 &lt; 0)) __pyx_t_41 = 1;
          } else if (unlikely(__pyx_t_39 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_41 = 1;
          if (__pyx_t_40 &lt; 0) {
            __pyx_t_40 += __pyx_pybuffernd_seg.diminfo[2].shape;
            if (unlikely(__pyx_t_40 &lt; 0)) __pyx_t_41 = 2;
          } else if (unlikely(__pyx_t_40 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_41 = 2;
          if (unlikely(__pyx_t_41 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_41);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_16 = ((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_36, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_39, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_40, __pyx_pybuffernd_seg.diminfo[2].strides)) != 0);
          if (__pyx_t_16) {
          } else {
            __pyx_t_12 = __pyx_t_16;
            goto __pyx_L14_bool_binop_done;
          }
          __pyx_t_41 = __pyx_v_z;
          __pyx_t_42 = __pyx_v_y;
          __pyx_t_43 = __pyx_v_x;
          __pyx_t_44 = -1;
          if (__pyx_t_41 &lt; 0) {
            __pyx_t_41 += __pyx_pybuffernd_seg.diminfo[0].shape;
            if (unlikely(__pyx_t_41 &lt; 0)) __pyx_t_44 = 0;
          } else if (unlikely(__pyx_t_41 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_44 = 0;
          if (__pyx_t_42 &lt; 0) {
            __pyx_t_42 += __pyx_pybuffernd_seg.diminfo[1].shape;
            if (unlikely(__pyx_t_42 &lt; 0)) __pyx_t_44 = 1;
          } else if (unlikely(__pyx_t_42 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_44 = 1;
          if (__pyx_t_43 &lt; 0) {
            __pyx_t_43 += __pyx_pybuffernd_seg.diminfo[2].shape;
            if (unlikely(__pyx_t_43 &lt; 0)) __pyx_t_44 = 2;
          } else if (unlikely(__pyx_t_43 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_44 = 2;
          if (unlikely(__pyx_t_44 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_44);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_44 = __pyx_v_z;
          __pyx_t_45 = (__pyx_v_y - 1);
          __pyx_t_46 = __pyx_v_x;
          __pyx_t_47 = -1;
          if (__pyx_t_44 &lt; 0) {
            __pyx_t_44 += __pyx_pybuffernd_seg.diminfo[0].shape;
            if (unlikely(__pyx_t_44 &lt; 0)) __pyx_t_47 = 0;
          } else if (unlikely(__pyx_t_44 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_47 = 0;
          if (__pyx_t_45 &lt; 0) {
            __pyx_t_45 += __pyx_pybuffernd_seg.diminfo[1].shape;
            if (unlikely(__pyx_t_45 &lt; 0)) __pyx_t_47 = 1;
          } else if (unlikely(__pyx_t_45 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_47 = 1;
          if (__pyx_t_46 &lt; 0) {
            __pyx_t_46 += __pyx_pybuffernd_seg.diminfo[2].shape;
            if (unlikely(__pyx_t_46 &lt; 0)) __pyx_t_47 = 2;
          } else if (unlikely(__pyx_t_46 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_47 = 2;
          if (unlikely(__pyx_t_47 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_47);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_16 = (((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_41, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_42, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_43, __pyx_pybuffernd_seg.diminfo[2].strides)) != (*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_44, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_45, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_46, __pyx_pybuffernd_seg.diminfo[2].strides))) != 0);
          __pyx_t_12 = __pyx_t_16;
          __pyx_L14_bool_binop_done:;
          if (__pyx_t_12) {
</pre><pre class='cython line score-58' onclick='toggleDiv(this)'>+85:                         con = add_item(con,frozenset([seg[z,y,x], seg[z,y-1,x]]), affin[1,z,y,x])</pre>
<pre class='cython code score-58'>            __pyx_t_23 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_add_item);<span class='error_goto'> if (unlikely(!__pyx_t_23)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_23);
            __pyx_t_47 = __pyx_v_z;
            __pyx_t_48 = __pyx_v_y;
            __pyx_t_49 = __pyx_v_x;
            __pyx_t_50 = -1;
            if (__pyx_t_47 &lt; 0) {
              __pyx_t_47 += __pyx_pybuffernd_seg.diminfo[0].shape;
              if (unlikely(__pyx_t_47 &lt; 0)) __pyx_t_50 = 0;
            } else if (unlikely(__pyx_t_47 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_50 = 0;
            if (__pyx_t_48 &lt; 0) {
              __pyx_t_48 += __pyx_pybuffernd_seg.diminfo[1].shape;
              if (unlikely(__pyx_t_48 &lt; 0)) __pyx_t_50 = 1;
            } else if (unlikely(__pyx_t_48 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_50 = 1;
            if (__pyx_t_49 &lt; 0) {
              __pyx_t_49 += __pyx_pybuffernd_seg.diminfo[2].shape;
              if (unlikely(__pyx_t_49 &lt; 0)) __pyx_t_50 = 2;
            } else if (unlikely(__pyx_t_49 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_50 = 2;
            if (unlikely(__pyx_t_50 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_50);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            __pyx_t_38 = __Pyx_PyInt_From_npy_uint32((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_47, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_48, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_49, __pyx_pybuffernd_seg.diminfo[2].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_38)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_38);
            __pyx_t_50 = __pyx_v_z;
            __pyx_t_51 = (__pyx_v_y - 1);
            __pyx_t_52 = __pyx_v_x;
            __pyx_t_53 = -1;
            if (__pyx_t_50 &lt; 0) {
              __pyx_t_50 += __pyx_pybuffernd_seg.diminfo[0].shape;
              if (unlikely(__pyx_t_50 &lt; 0)) __pyx_t_53 = 0;
            } else if (unlikely(__pyx_t_50 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_53 = 0;
            if (__pyx_t_51 &lt; 0) {
              __pyx_t_51 += __pyx_pybuffernd_seg.diminfo[1].shape;
              if (unlikely(__pyx_t_51 &lt; 0)) __pyx_t_53 = 1;
            } else if (unlikely(__pyx_t_51 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_53 = 1;
            if (__pyx_t_52 &lt; 0) {
              __pyx_t_52 += __pyx_pybuffernd_seg.diminfo[2].shape;
              if (unlikely(__pyx_t_52 &lt; 0)) __pyx_t_53 = 2;
            } else if (unlikely(__pyx_t_52 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_53 = 2;
            if (unlikely(__pyx_t_53 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_53);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            __pyx_t_32 = __Pyx_PyInt_From_npy_uint32((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_50, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_51, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_52, __pyx_pybuffernd_seg.diminfo[2].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_32)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_32);
            __pyx_t_31 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_31)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_31);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_31, 0, __pyx_t_38);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_38);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_31, 1, __pyx_t_32);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_32);
            __pyx_t_38 = 0;
            __pyx_t_32 = 0;
            __pyx_t_32 = <span class='pyx_c_api'>__Pyx_PyFrozenSet_New</span>(__pyx_t_31);<span class='error_goto'> if (unlikely(!__pyx_t_32)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_32);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_31); __pyx_t_31 = 0;
            __pyx_t_54 = 1;
            __pyx_t_53 = __pyx_v_z;
            __pyx_t_55 = __pyx_v_y;
            __pyx_t_56 = __pyx_v_x;
            __pyx_t_57 = -1;
            if (__pyx_t_54 &lt; 0) {
              __pyx_t_54 += __pyx_pybuffernd_affin.diminfo[0].shape;
              if (unlikely(__pyx_t_54 &lt; 0)) __pyx_t_57 = 0;
            } else if (unlikely(__pyx_t_54 &gt;= __pyx_pybuffernd_affin.diminfo[0].shape)) __pyx_t_57 = 0;
            if (__pyx_t_53 &lt; 0) {
              __pyx_t_53 += __pyx_pybuffernd_affin.diminfo[1].shape;
              if (unlikely(__pyx_t_53 &lt; 0)) __pyx_t_57 = 1;
            } else if (unlikely(__pyx_t_53 &gt;= __pyx_pybuffernd_affin.diminfo[1].shape)) __pyx_t_57 = 1;
            if (__pyx_t_55 &lt; 0) {
              __pyx_t_55 += __pyx_pybuffernd_affin.diminfo[2].shape;
              if (unlikely(__pyx_t_55 &lt; 0)) __pyx_t_57 = 2;
            } else if (unlikely(__pyx_t_55 &gt;= __pyx_pybuffernd_affin.diminfo[2].shape)) __pyx_t_57 = 2;
            if (__pyx_t_56 &lt; 0) {
              __pyx_t_56 += __pyx_pybuffernd_affin.diminfo[3].shape;
              if (unlikely(__pyx_t_56 &lt; 0)) __pyx_t_57 = 3;
            } else if (unlikely(__pyx_t_56 &gt;= __pyx_pybuffernd_affin.diminfo[3].shape)) __pyx_t_57 = 3;
            if (unlikely(__pyx_t_57 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_57);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            __pyx_t_31 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided4d(__pyx_t_5numpy_float32_t *, __pyx_pybuffernd_affin.rcbuffer-&gt;pybuffer.buf, __pyx_t_54, __pyx_pybuffernd_affin.diminfo[0].strides, __pyx_t_53, __pyx_pybuffernd_affin.diminfo[1].strides, __pyx_t_55, __pyx_pybuffernd_affin.diminfo[2].strides, __pyx_t_56, __pyx_pybuffernd_affin.diminfo[3].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_31)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_31);
            __pyx_t_38 = NULL;
            __pyx_t_37 = 0;
            if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_23))) {
              __pyx_t_38 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_23);
              if (likely(__pyx_t_38)) {
                PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_23);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_38);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_23, function);
                __pyx_t_37 = 1;
              }
            }
            __pyx_t_27 = <span class='py_c_api'>PyTuple_New</span>(3+__pyx_t_37);<span class='error_goto'> if (unlikely(!__pyx_t_27)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_27);
            if (__pyx_t_38) {
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_27, 0, __pyx_t_38); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_38); __pyx_t_38 = NULL;
            }
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_con);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_27, 0+__pyx_t_37, __pyx_v_con);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_con);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_27, 1+__pyx_t_37, __pyx_t_32);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_32);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_27, 2+__pyx_t_37, __pyx_t_31);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_31);
            __pyx_t_32 = 0;
            __pyx_t_31 = 0;
            __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_23, __pyx_t_27, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_27); __pyx_t_27 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_23); __pyx_t_23 = 0;
            if (!(likely(<span class='py_c_api'>PyDict_CheckExact</span>(__pyx_t_1))||((__pyx_t_1) == Py_None)||(<span class='py_c_api'>PyErr_Format</span>(PyExc_TypeError, "Expected %.16s, got %.200s", "dict", Py_TYPE(__pyx_t_1)-&gt;tp_name), 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_con, ((PyObject*)__pyx_t_1));
            __pyx_t_1 = 0;
            goto __pyx_L13;
          }
          __pyx_L13:;
</pre><pre class='cython line score-6' onclick='toggleDiv(this)'>+86:                     if seg[z,y,x-1] and seg[z,y,x]!=seg[z,y,x-1]:</pre>
<pre class='cython code score-6'>          __pyx_t_57 = __pyx_v_z;
          __pyx_t_58 = __pyx_v_y;
          __pyx_t_59 = (__pyx_v_x - 1);
          __pyx_t_60 = -1;
          if (__pyx_t_57 &lt; 0) {
            __pyx_t_57 += __pyx_pybuffernd_seg.diminfo[0].shape;
            if (unlikely(__pyx_t_57 &lt; 0)) __pyx_t_60 = 0;
          } else if (unlikely(__pyx_t_57 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_60 = 0;
          if (__pyx_t_58 &lt; 0) {
            __pyx_t_58 += __pyx_pybuffernd_seg.diminfo[1].shape;
            if (unlikely(__pyx_t_58 &lt; 0)) __pyx_t_60 = 1;
          } else if (unlikely(__pyx_t_58 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_60 = 1;
          if (__pyx_t_59 &lt; 0) {
            __pyx_t_59 += __pyx_pybuffernd_seg.diminfo[2].shape;
            if (unlikely(__pyx_t_59 &lt; 0)) __pyx_t_60 = 2;
          } else if (unlikely(__pyx_t_59 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_60 = 2;
          if (unlikely(__pyx_t_60 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_60);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_16 = ((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_57, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_58, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_59, __pyx_pybuffernd_seg.diminfo[2].strides)) != 0);
          if (__pyx_t_16) {
          } else {
            __pyx_t_12 = __pyx_t_16;
            goto __pyx_L17_bool_binop_done;
          }
          __pyx_t_60 = __pyx_v_z;
          __pyx_t_61 = __pyx_v_y;
          __pyx_t_62 = __pyx_v_x;
          __pyx_t_63 = -1;
          if (__pyx_t_60 &lt; 0) {
            __pyx_t_60 += __pyx_pybuffernd_seg.diminfo[0].shape;
            if (unlikely(__pyx_t_60 &lt; 0)) __pyx_t_63 = 0;
          } else if (unlikely(__pyx_t_60 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_63 = 0;
          if (__pyx_t_61 &lt; 0) {
            __pyx_t_61 += __pyx_pybuffernd_seg.diminfo[1].shape;
            if (unlikely(__pyx_t_61 &lt; 0)) __pyx_t_63 = 1;
          } else if (unlikely(__pyx_t_61 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_63 = 1;
          if (__pyx_t_62 &lt; 0) {
            __pyx_t_62 += __pyx_pybuffernd_seg.diminfo[2].shape;
            if (unlikely(__pyx_t_62 &lt; 0)) __pyx_t_63 = 2;
          } else if (unlikely(__pyx_t_62 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_63 = 2;
          if (unlikely(__pyx_t_63 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_63);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_63 = __pyx_v_z;
          __pyx_t_64 = __pyx_v_y;
          __pyx_t_65 = (__pyx_v_x - 1);
          __pyx_t_66 = -1;
          if (__pyx_t_63 &lt; 0) {
            __pyx_t_63 += __pyx_pybuffernd_seg.diminfo[0].shape;
            if (unlikely(__pyx_t_63 &lt; 0)) __pyx_t_66 = 0;
          } else if (unlikely(__pyx_t_63 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_66 = 0;
          if (__pyx_t_64 &lt; 0) {
            __pyx_t_64 += __pyx_pybuffernd_seg.diminfo[1].shape;
            if (unlikely(__pyx_t_64 &lt; 0)) __pyx_t_66 = 1;
          } else if (unlikely(__pyx_t_64 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_66 = 1;
          if (__pyx_t_65 &lt; 0) {
            __pyx_t_65 += __pyx_pybuffernd_seg.diminfo[2].shape;
            if (unlikely(__pyx_t_65 &lt; 0)) __pyx_t_66 = 2;
          } else if (unlikely(__pyx_t_65 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_66 = 2;
          if (unlikely(__pyx_t_66 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_66);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_16 = (((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_60, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_61, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_62, __pyx_pybuffernd_seg.diminfo[2].strides)) != (*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_63, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_64, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_65, __pyx_pybuffernd_seg.diminfo[2].strides))) != 0);
          __pyx_t_12 = __pyx_t_16;
          __pyx_L17_bool_binop_done:;
          if (__pyx_t_12) {
</pre><pre class='cython line score-58' onclick='toggleDiv(this)'>+87:                         con = add_item(con,frozenset([seg[z,y,x], seg[z,y,x-1]]), affin[0,z,y,x])</pre>
<pre class='cython code score-58'>            __pyx_t_23 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_add_item);<span class='error_goto'> if (unlikely(!__pyx_t_23)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_23);
            __pyx_t_66 = __pyx_v_z;
            __pyx_t_67 = __pyx_v_y;
            __pyx_t_68 = __pyx_v_x;
            __pyx_t_69 = -1;
            if (__pyx_t_66 &lt; 0) {
              __pyx_t_66 += __pyx_pybuffernd_seg.diminfo[0].shape;
              if (unlikely(__pyx_t_66 &lt; 0)) __pyx_t_69 = 0;
            } else if (unlikely(__pyx_t_66 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_69 = 0;
            if (__pyx_t_67 &lt; 0) {
              __pyx_t_67 += __pyx_pybuffernd_seg.diminfo[1].shape;
              if (unlikely(__pyx_t_67 &lt; 0)) __pyx_t_69 = 1;
            } else if (unlikely(__pyx_t_67 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_69 = 1;
            if (__pyx_t_68 &lt; 0) {
              __pyx_t_68 += __pyx_pybuffernd_seg.diminfo[2].shape;
              if (unlikely(__pyx_t_68 &lt; 0)) __pyx_t_69 = 2;
            } else if (unlikely(__pyx_t_68 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_69 = 2;
            if (unlikely(__pyx_t_69 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_69);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            __pyx_t_27 = __Pyx_PyInt_From_npy_uint32((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_66, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_67, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_68, __pyx_pybuffernd_seg.diminfo[2].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_27)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_27);
            __pyx_t_69 = __pyx_v_z;
            __pyx_t_70 = __pyx_v_y;
            __pyx_t_71 = (__pyx_v_x - 1);
            __pyx_t_72 = -1;
            if (__pyx_t_69 &lt; 0) {
              __pyx_t_69 += __pyx_pybuffernd_seg.diminfo[0].shape;
              if (unlikely(__pyx_t_69 &lt; 0)) __pyx_t_72 = 0;
            } else if (unlikely(__pyx_t_69 &gt;= __pyx_pybuffernd_seg.diminfo[0].shape)) __pyx_t_72 = 0;
            if (__pyx_t_70 &lt; 0) {
              __pyx_t_70 += __pyx_pybuffernd_seg.diminfo[1].shape;
              if (unlikely(__pyx_t_70 &lt; 0)) __pyx_t_72 = 1;
            } else if (unlikely(__pyx_t_70 &gt;= __pyx_pybuffernd_seg.diminfo[1].shape)) __pyx_t_72 = 1;
            if (__pyx_t_71 &lt; 0) {
              __pyx_t_71 += __pyx_pybuffernd_seg.diminfo[2].shape;
              if (unlikely(__pyx_t_71 &lt; 0)) __pyx_t_72 = 2;
            } else if (unlikely(__pyx_t_71 &gt;= __pyx_pybuffernd_seg.diminfo[2].shape)) __pyx_t_72 = 2;
            if (unlikely(__pyx_t_72 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_72);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            __pyx_t_31 = __Pyx_PyInt_From_npy_uint32((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_uint32_t *, __pyx_pybuffernd_seg.rcbuffer-&gt;pybuffer.buf, __pyx_t_69, __pyx_pybuffernd_seg.diminfo[0].strides, __pyx_t_70, __pyx_pybuffernd_seg.diminfo[1].strides, __pyx_t_71, __pyx_pybuffernd_seg.diminfo[2].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_31)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_31);
            __pyx_t_32 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_32)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_32);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_32, 0, __pyx_t_27);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_27);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_32, 1, __pyx_t_31);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_31);
            __pyx_t_27 = 0;
            __pyx_t_31 = 0;
            __pyx_t_31 = <span class='pyx_c_api'>__Pyx_PyFrozenSet_New</span>(__pyx_t_32);<span class='error_goto'> if (unlikely(!__pyx_t_31)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_31);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_32); __pyx_t_32 = 0;
            __pyx_t_73 = 0;
            __pyx_t_72 = __pyx_v_z;
            __pyx_t_74 = __pyx_v_y;
            __pyx_t_75 = __pyx_v_x;
            __pyx_t_76 = -1;
            if (__pyx_t_73 &lt; 0) {
              __pyx_t_73 += __pyx_pybuffernd_affin.diminfo[0].shape;
              if (unlikely(__pyx_t_73 &lt; 0)) __pyx_t_76 = 0;
            } else if (unlikely(__pyx_t_73 &gt;= __pyx_pybuffernd_affin.diminfo[0].shape)) __pyx_t_76 = 0;
            if (__pyx_t_72 &lt; 0) {
              __pyx_t_72 += __pyx_pybuffernd_affin.diminfo[1].shape;
              if (unlikely(__pyx_t_72 &lt; 0)) __pyx_t_76 = 1;
            } else if (unlikely(__pyx_t_72 &gt;= __pyx_pybuffernd_affin.diminfo[1].shape)) __pyx_t_76 = 1;
            if (__pyx_t_74 &lt; 0) {
              __pyx_t_74 += __pyx_pybuffernd_affin.diminfo[2].shape;
              if (unlikely(__pyx_t_74 &lt; 0)) __pyx_t_76 = 2;
            } else if (unlikely(__pyx_t_74 &gt;= __pyx_pybuffernd_affin.diminfo[2].shape)) __pyx_t_76 = 2;
            if (__pyx_t_75 &lt; 0) {
              __pyx_t_75 += __pyx_pybuffernd_affin.diminfo[3].shape;
              if (unlikely(__pyx_t_75 &lt; 0)) __pyx_t_76 = 3;
            } else if (unlikely(__pyx_t_75 &gt;= __pyx_pybuffernd_affin.diminfo[3].shape)) __pyx_t_76 = 3;
            if (unlikely(__pyx_t_76 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_76);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            __pyx_t_32 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided4d(__pyx_t_5numpy_float32_t *, __pyx_pybuffernd_affin.rcbuffer-&gt;pybuffer.buf, __pyx_t_73, __pyx_pybuffernd_affin.diminfo[0].strides, __pyx_t_72, __pyx_pybuffernd_affin.diminfo[1].strides, __pyx_t_74, __pyx_pybuffernd_affin.diminfo[2].strides, __pyx_t_75, __pyx_pybuffernd_affin.diminfo[3].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_32)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_32);
            __pyx_t_27 = NULL;
            __pyx_t_37 = 0;
            if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_23))) {
              __pyx_t_27 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_23);
              if (likely(__pyx_t_27)) {
                PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_23);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_27);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_23, function);
                __pyx_t_37 = 1;
              }
            }
            __pyx_t_38 = <span class='py_c_api'>PyTuple_New</span>(3+__pyx_t_37);<span class='error_goto'> if (unlikely(!__pyx_t_38)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_38);
            if (__pyx_t_27) {
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_38, 0, __pyx_t_27); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_27); __pyx_t_27 = NULL;
            }
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_con);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_38, 0+__pyx_t_37, __pyx_v_con);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_con);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_38, 1+__pyx_t_37, __pyx_t_31);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_31);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_38, 2+__pyx_t_37, __pyx_t_32);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_32);
            __pyx_t_31 = 0;
            __pyx_t_32 = 0;
            __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_23, __pyx_t_38, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_38); __pyx_t_38 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_23); __pyx_t_23 = 0;
            if (!(likely(<span class='py_c_api'>PyDict_CheckExact</span>(__pyx_t_1))||((__pyx_t_1) == Py_None)||(<span class='py_c_api'>PyErr_Format</span>(PyExc_TypeError, "Expected %.16s, got %.200s", "dict", Py_TYPE(__pyx_t_1)-&gt;tp_name), 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_con, ((PyObject*)__pyx_t_1));
            __pyx_t_1 = 0;
            goto __pyx_L16;
          }
          __pyx_L16:;
          goto __pyx_L9;
        }
        __pyx_L9:;
      }
    }
  }
</pre><pre class='cython line score-2' onclick='toggleDiv(this)'>+88:     return con</pre>
<pre class='cython code score-2'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_con);
  __pyx_r = __pyx_v_con;
  goto __pyx_L0;
</pre></div></body></html>
